# ğŸ¤– HRC åä½œæœºå™¨äººè¿åŠ¨è§„åˆ’ç³»ç»Ÿ

<p align="center">
  <a href="https://www.huayan-robotics.com">
    <img src="https://www.huayan-robotics.com/media/upload/index/Huayan%20Elfin%20index%20banner.jpg" alt="Huayan Robotics" width="600">
  </a>
</p>

<p align="center">
  <a href="LICENSE"><img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License"></a>
  <a href="https://isocpp.org/"><img src="https://img.shields.io/badge/C++-17-blue.svg" alt="C++"></a>
  <a href="https://www.linux.org/"><img src="https://img.shields.io/badge/Platform-Linux%20x86__64-lightgrey.svg" alt="Platform"></a>
  <a href="https://www.huayan-robotics.com"><img src="https://img.shields.io/badge/Huayan-Robotics-orange.svg" alt="Huayan"></a>
  <a href="#æ€§èƒ½æŒ‡æ ‡"><img src="https://img.shields.io/badge/Pipeline-98ms-blueviolet.svg" alt="Pipeline"></a>
  <a href="#æ€§èƒ½æŒ‡æ ‡"><img src="https://img.shields.io/badge/Success_Rate-100%25-success.svg" alt="Success Rate"></a>
</p>

<p align="center">
  <b>HR_S50-2000 å·¥ä¸šåä½œæœºå™¨äººç å›åœºæ™¯æœ€ä¼˜è¿åŠ¨è§„åˆ’ç³»ç»Ÿ</b><br>
  ä¸“ä¸ºç å›åœºæ™¯è®¾è®¡çš„é«˜æ€§èƒ½è·¯å¾„è§„åˆ’ä¸è½¨è¿¹ç”Ÿæˆè§£å†³æ–¹æ¡ˆ<br>
  <code>C++17 Header-Only</code> Â· <code>9,600+ è¡Œæ ¸å¿ƒä»£ç </code> Â· <code>18 ä¸ªæ¨¡å—</code> Â· <code>98ms ç«¯åˆ°ç«¯</code>
</p>

<p align="center">
  <a href="https://www.huayan-robotics.com">ğŸŒ å®˜ç½‘</a> â€¢
  <a href="mailto:yuesj@huayan-robotics.com">ğŸ“§ è”ç³»æˆ‘ä»¬</a> â€¢
  <a href="docs/API.md">ğŸ“– API æ–‡æ¡£</a> â€¢
  <a href="examples/">ğŸ’¡ ç¤ºä¾‹</a> â€¢
  <a href="CHANGELOG.md">ğŸ“‹ å˜æ›´æ—¥å¿—</a>
</p>

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [âš ï¸ å…³é”®å•ä½çº¦å®š](#ï¸-å…³é”®å•ä½çº¦å®š)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
  - [åŒæ ˆæ¶æ„](#åŒæ ˆæ¶æ„)
  - [SOæ ˆ (æ¨è)](#soæ ˆ-æ¨è)
  - [é™æ€åº“æ ˆ (å‘åå…¼å®¹)](#é™æ€åº“æ ˆ-å‘åå…¼å®¹)
  - [æ•°æ®æµç®¡çº¿](#æ•°æ®æµç®¡çº¿)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [ç¢°æ’æ£€æµ‹æ¶æ„](#ç¢°æ’æ£€æµ‹æ¶æ„)
- [é…ç½®ä¸è°ƒä¼˜](#é…ç½®ä¸è°ƒä¼˜)
- [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
- [æŠ€æœ¯è§„æ ¼](#æŠ€æœ¯è§„æ ¼)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [MATLAB ä»¿çœŸéªŒè¯](#matlab-ä»¿çœŸéªŒè¯)
- [Python å¯è§†åŒ–å·¥å…·](#python-å¯è§†åŒ–å·¥å…·)
- [æ•°æ®æ–‡ä»¶æ ¼å¼è§„èŒƒ](#æ•°æ®æ–‡ä»¶æ ¼å¼è§„èŒƒ)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [è°ƒè¯•ä¸æ•…éšœæ’é™¤](#è°ƒè¯•ä¸æ•…éšœæ’é™¤)
- [ç‰ˆæœ¬å†å²](#ç‰ˆæœ¬å†å²)
- [è®¸å¯è¯](#è®¸å¯è¯)

---

## é¡¹ç›®æ¦‚è¿°

æœ¬ç³»ç»Ÿä¸º **HR_S50-2000 å·¥ä¸šåä½œæœºå™¨äºº**å®ç°**ç å›åœºæ™¯æœ€ä¼˜è¿åŠ¨è§„åˆ’**ã€‚é‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼š

### 1. C++17 Header-Only è¿åŠ¨è§„åˆ’å™¨ â­

18 ä¸ªå¤´æ–‡ä»¶ã€9,600+ è¡Œçº¯å¤´æ–‡ä»¶å®ç°ï¼Œé›¶ç¼–è¯‘ä¾èµ–ï¼Œç”¨æˆ·ä»…éœ€ `#include` å³å¯ä½¿ç”¨ã€‚

**åŒæ ˆè®¾è®¡**ï¼š
- **SO åŠ¨æ€åº“æ ˆ (æ¨è)** â€” `dlopen(libHRCInterface.so)` è¿è¡Œæ—¶åŠ è½½ï¼Œå« FK/IK/ç¯å¢ƒç¢°æ’
- **é™æ€åº“æ ˆ (å‘åå…¼å®¹)** â€” `extern "C"` é“¾æ¥ `.a` é™æ€åº“

### 2. HRC ç¢°æ’æ£€æµ‹åº“ (é—­æº)

äººæœºåä½œ (Human-Robot Collaboration) åœºæ™¯å®æ—¶ç¢°æ’æ£€æµ‹ã€‚
- **`libHRCInterface.so`** (SOæ ˆ): åŠ¨æ€åº“ï¼Œè¿è¡Œæ—¶åŠ è½½ï¼Œå«å®Œæ•´ FK/IK/ç¢°æ’æ£€æµ‹
- **`libHRCInterface.a` + `libCmpAgu.a` + `libhansKinematics.a`** (é™æ€åº“æ ˆ): é¢„ç¼–è¯‘é™æ€åº“

### 3. MATLAB / Python å¯è§†åŒ–æ¨¡å—

- **MATLAB**: URDF/STL ç²¾ç¡® 3D æ¸²æŸ“ + `libHRCInterface.so` ç¢°æ’è·ç¦»äº¤å‰éªŒè¯ (v15.0)
- **Python**: matplotlib / PyVista å¯è§†åŒ–ï¼Œå« STL ç½‘æ ¼æ¸²æŸ“ã€è½¨è¿¹åŠ¨ç”»

---

## âš ï¸ å…³é”®å•ä½çº¦å®š

> **è¿™æ˜¯å¼€å‘ä¸­æœ€å¸¸è§çš„é”™è¯¯æºï¼Œè¯·åŠ¡å¿…ä»”ç»†é˜…è¯»ï¼**

| ä½ç½® | å…³èŠ‚è§’ | åæ ‡/è·ç¦» |
|------|--------|----------|
| ç”¨æˆ· API `JointConfig::fromDegrees()` | **deg** | â€” |
| å†…éƒ¨å­˜å‚¨ `config.q[i]` / è·¯å¾„æ–‡ä»¶ | **rad** | â€” |
| HRC `.so` æ¥å£ (update/FK/IK) | **deg** | **mm** |
| HRC `.so` FK è¾“å‡ºä½ç½® | â€” | **m** (âš ï¸ é mm) |
| HRC `.so` FK è¾“å‡ºå§¿æ€ | **deg** | â€” |
| CollisionGeometry.hpp ç¢°æ’å‡ ä½• | â€” | **mm** |
| `SceneConfig` / `OBBObstacle.lwh` | â€” | **m** |
| HRC ç¢°æ’è·ç¦»è¿”å›å€¼ (SO) | â€” | **mm** |
| HRC ç¢°æ’è·ç¦»è¿”å›å€¼ (é™æ€åº“) | â€” | **m** |
| `.hard` ç¡¬ä»¶é…ç½® | **deg** | **mm** |

```cpp
// âŒ é”™è¯¯: ç›´æ¥ä½¿ç”¨åº¦æ•°ï¼ˆå†…éƒ¨æœŸæœ›å¼§åº¦ï¼‰
JointConfig config;
config.q[0] = 90;  // BUG! å†…éƒ¨å­˜å‚¨çš„æ˜¯å¼§åº¦

// âœ… æ­£ç¡®: ä½¿ç”¨å·¥å‚æ–¹æ³•
JointConfig config = JointConfig::fromDegrees({90, -50, 70, 0, 80, 0});
```

**æ ¸å¿ƒåŸåˆ™**: æ‰€æœ‰å…¬å…± API æ¥å—åº¦ (deg)ï¼Œå†…éƒ¨ç«‹å³è½¬æ¢ä¸ºå¼§åº¦ (rad)ï¼Œæ–‡ä»¶è¾“å‡ºä½¿ç”¨ radã€‚

---

## ç³»ç»Ÿæ¶æ„

### åŒæ ˆæ¶æ„

æœ¬é¡¹ç›®æä¾›ä¸¤å¥—æŠ€æœ¯æ ˆï¼Œ**æ¨èä½¿ç”¨ SO æ ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â˜… SO åŠ¨æ€åº“æ ˆ (æ¨è)                                     â”‚
â”‚                                                                         â”‚
â”‚  CollisionCheckerSO.hpp   â† dlopen(libHRCInterface.so), å«FK/IK/ç¯å¢ƒç¢°æ’ â”‚
â”‚  â”œâ”€â”€ PathPlannerSO.hpp    â† Free-TCP Informed RRT* + IncrementalKDTree6D â”‚
â”‚  â”œâ”€â”€ PathOptimizer.hpp    â† B-Spline å¹³æ»‘ (De Boorç®—æ³•)                  â”‚
â”‚  â”œâ”€â”€ TimeParameterization â† Sæ›²çº¿ (å†…ç½®) / libCmpRML.so (çœŸå®æ‰§è¡Œ)        â”‚
â”‚  â”œâ”€â”€ CollisionGeometry.hppâ† ç»Ÿä¸€S50ç¢°æ’åŒ…ç»œå‚æ•°                           â”‚
â”‚  â”œâ”€â”€ RobotModel.hpp       â† DHæ­£è¿åŠ¨å­¦ + æ•°å€¼Jacobian                    â”‚
â”‚  â””â”€â”€ Types.hpp            â† JointConfig, Path, BSpline, PlanningResult   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  é™æ€åº“æ ˆ (å‘åå…¼å®¹)                                       â”‚
â”‚                                                                         â”‚
â”‚  PalletizingPlanner.hpp   â† é¡¶å±‚API (ä½¿ç”¨ CollisionChecker + é™æ€åº“)     â”‚
â”‚  â”œâ”€â”€ PathPlannerOptimized â† KDTree + CollisionCache ä¼˜åŒ– RRT*            â”‚
â”‚  â”œâ”€â”€ HighPerformancePlanner â† å…¨ä¼˜åŒ–æµæ°´çº¿                                â”‚
â”‚  â”œâ”€â”€ KDTree.hpp           â† æ‰¹é‡æ„å»º KD-Tree                             â”‚
â”‚  â”œâ”€â”€ CollisionCache.hpp   â† FNV-1a å“ˆå¸Œ + LRU ç¼“å­˜                      â”‚
â”‚  â””â”€â”€ TaskSequencer.hpp    â† TSP 2-opt ä»»åŠ¡åºåˆ—ä¼˜åŒ–                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SOæ ˆ (æ¨è)

**æ ¸å¿ƒåˆ›æ–° â€” è‡ªç”±TCPæ¨¡å¼**ï¼šç å›åœºæ™¯ä¸­å¸ç›˜å¸åŠ›è¶³å¤Ÿå¤§ï¼Œè¿åŠ¨è¿‡ç¨‹ä¸­ TCP ä½å§¿å¯è‡ªç”±å˜åŒ– (`freeTcpDuringTransit=true`)ï¼Œä»…èµ·æ­¢ç‚¹ TCP è¢«çº¦æŸã€‚è¿™ï¼š
- æ‰©å¤§äº†å¯è¡Œé…ç½®ç©ºé—´ï¼Œäº§ç”Ÿæ›´çŸ­è·¯å¾„
- å¢å¼ºé¿éšœèƒ½åŠ›
- æ¶ˆé™¤è§„åˆ’è¿‡ç¨‹ä¸­çš„ FK è°ƒç”¨å¼€é”€ï¼ˆçº¯å…³èŠ‚ç©ºé—´ä»£ä»·ï¼‰

```
CollisionCheckerSO (726è¡Œ)    â† dlopen libHRCInterface.so, å«TimingStats
â”œâ”€â”€ PathPlannerSO (913è¡Œ)     â† Free-TCP Informed RRT* + IncrementalKDTree6D
â”œâ”€â”€ PathOptimizer (460è¡Œ)     â† B-Spline è·¯å¾„å¹³æ»‘
â”œâ”€â”€ TimeParameterization      â† Sæ›²çº¿ (å†…ç½®430è¡Œ) / libCmpRML.so
â”œâ”€â”€ CollisionGeometry (70è¡Œ)  â† ç»Ÿä¸€S50ç¢°æ’åŒ…ç»œ
â”œâ”€â”€ RobotModel (329è¡Œ)        â† DHæ­£è¿åŠ¨å­¦ + Jacobian
â””â”€â”€ Types (487è¡Œ)             â† æ ¸å¿ƒæ•°æ®ç±»å‹
```

### é™æ€åº“æ ˆ (å‘åå…¼å®¹)

```
PalletizingPlanner (418è¡Œ)    â† é¡¶å±‚ Facade API
â”œâ”€â”€ PathPlannerOptimized (862è¡Œ) â† alignas(64) + æ¤­çƒé‡‡æ · + æ‡’æƒ°ç¢°æ’
â”œâ”€â”€ PathOptimizerOptimized (649è¡Œ) â† è‡ªé€‚åº”æ·å¾„ + å¢é‡B-Spline
â”œâ”€â”€ TimeParameterizationOptimized (480è¡Œ) â† Sæ›²çº¿æŸ¥è¡¨åŠ é€Ÿ
â”œâ”€â”€ CollisionChecker (901è¡Œ)  â† extern "C" ä¸‰å±‚ç¢°æ’æ£€æµ‹
â”œâ”€â”€ CollisionCache (342è¡Œ)    â† FNV-1a + LRU ç¼“å­˜
â”œâ”€â”€ KDTree (293è¡Œ)            â† 6Dæ‰¹é‡KD-Tree
â”œâ”€â”€ HighPerformancePlanner (532è¡Œ) â† å…¨ä¼˜åŒ–æµæ°´çº¿
â”œâ”€â”€ ParallelPathPlanner (558è¡Œ) â† v3.0 è¶…é«˜æ€§èƒ½
â””â”€â”€ TaskSequencer (457è¡Œ)     â† TSP 2-opt
```

### æ•°æ®æµç®¡çº¿

```
ç”¨æˆ·è¾“å…¥ TCP Pose (mm, deg) / JointConfig (deg)
    â”‚
    â–¼ IK æ±‚è§£ (è‹¥è¾“å…¥ä¸ºTCPä½å§¿)
    â”‚   â””â”€â”€ å¤šèµ·ç‚¹æ•°å€¼IK (Damped Least-Squares, ~0.1ms/æ¬¡)
    â”‚
    â–¼ PathPlannerSO.plan(start, goal)
    â”‚   â”œâ”€â”€ Informed RRT* (çº¯å…³èŠ‚ç©ºé—´ä»£ä»·, TCPè‡ªç”±å˜åŒ–)
    â”‚   â”œâ”€â”€ IncrementalKDTree6D æœ€è¿‘é‚»åŠ é€Ÿ (O(log n))
    â”‚   â”œâ”€â”€ CollisionCheckerSO ç¢°æ’æ£€æµ‹ (.so dlopen)
    â”‚   â””â”€â”€ è·¯å¾„æå– + é‡è¿ä¼˜åŒ– (rewiring)
    â”‚
    â–¼ PathOptimizer.optimize(rawPath)
    â”‚   â”œâ”€â”€ æ·å¾„ä¼˜åŒ– (ç¢°æ’éªŒè¯)
    â”‚   â”œâ”€â”€ B-Spline æ‹Ÿåˆ (De Boor)
    â”‚   â””â”€â”€ ç¢°æ’å®‰å…¨æ€§æ ¡éªŒ
    â”‚
    â–¼ æ—¶é—´å‚æ•°åŒ– (libCmpRML.so Sæ›²çº¿ / TimeParameterization å†…ç½®)
    â”‚   â”œâ”€â”€ å…³èŠ‚é€Ÿåº¦/åŠ é€Ÿåº¦/åŠ åŠ é€Ÿåº¦é™ä½
    â”‚   â””â”€â”€ 4mså‘¨æœŸé‡‡æ · (250 Hz, ä¸ä¸Šä½æœºä¸€è‡´)
    â”‚
    â–¼ è¾“å‡ºè½¨è¿¹ â†’ data/*.txt (rad, ç©ºæ ¼åˆ†éš”)
    â”‚
    â–¼ MATLAB ä»¿çœŸéªŒè¯ â†’ ArmCollisionModel/pic/ (3Dæ¸²æŸ“+ç¢°æ’è·ç¦»æ›²çº¿)
```

---

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ è‡ªç”±TCPè¿åŠ¨è§„åˆ’ (SOæ ˆæ ¸å¿ƒ)

- **Free-TCP Informed RRT\*** â€” çº¯å…³èŠ‚ç©ºé—´ä»£ä»·å‡½æ•°ï¼Œè¿åŠ¨è¿‡ç¨‹ä¸­TCPä½å§¿å¯è‡ªç”±å˜åŒ–
- **IncrementalKDTree6D** â€” å¢é‡å¼6D KD-Treeï¼ŒO(log n) æœ€è¿‘é‚»
- **æ•°å€¼IKæ±‚è§£** â€” å¤šèµ·ç‚¹ Damped Least-Squaresï¼Œ~0.1ms/æ¬¡
- **åŠ¨æ€ç¯å¢ƒç¢°æ’ä½“** â€” è¿è¡Œæ—¶æ·»åŠ /ç§»é™¤çƒä½“å’Œèƒ¶å›Šä½“ï¼ˆç”µç®±ã€ä¼ é€å¸¦ã€æ¡†æ¶ã€å·²æ”¾ç®±å­ï¼‰

### ğŸ›¡ï¸ ç¢°æ’æ£€æµ‹ (åŒæ¨¡å¼)

**SOæ ˆ**: `dlopen` åŠ è½½ `libHRCInterface.so`
- è‡ªç¢°æ’æ£€æµ‹ (è¿æ†å¯¹èƒ¶å›Šä½“/çƒä½“è·ç¦»)
- ç¯å¢ƒç¢°æ’ä½“ (åŠ¨æ€æ·»åŠ çƒä½“/èƒ¶å›Šä½“)
- å·¥å…·ç¢°æ’çƒ (æ¬è¿å·¥å…·ä¿æŠ¤)
- ç¢°æ’è·ç¦»è¿”å›å€¼: **mm**

**é™æ€åº“æ ˆ**: `extern "C"` é“¾æ¥ `.a` åº“
- ä¸‰å±‚: è¿æ†è‡ªç¢°æ’ + è™šæ‹Ÿå¢™ + TCPå®‰å…¨åŒºåŸŸ
- FNV-1a + LRU ç¢°æ’ç¼“å­˜ (18x åŠ é€Ÿ)
- ç¢°æ’è·ç¦»è¿”å›å€¼: **m**

### ğŸ“ˆ è·¯å¾„ä¼˜åŒ–

- **è‡ªé€‚åº”éšæœºæ·å¾„** â€” ç¢°æ’éªŒè¯ä¸‹çš„å¿«é€Ÿè·¯å¾„ç¼©çŸ­
- **5æ¬¡ B-Spline å¹³æ»‘** â€” De Boor ç®—æ³•ä¿è¯ CÂ³ è¿ç»­ï¼ˆåŠ é€Ÿåº¦è¿ç»­ï¼‰
- **æ›²ç‡åˆ†æ** â€” ç¡®ä¿è·¯å¾„å¯æ‰§è¡Œæ€§

### â±ï¸ æ—¶é—´å‚æ•°åŒ–

- **libCmpRML.so** â€” åæ•°ä¸Šä½æœºçœŸå® S æ›²çº¿æ‰§è¡Œåº“ï¼Œæœªæ¥ç›´æ¥åœ¨å®é™…æœºå™¨äººä¸Šè¿è¡Œ
- **å†…ç½® S æ›²çº¿** â€” äº”æ¬¡å¤šé¡¹å¼è¿‘ä¼¼ä¸ƒæ®µå¼ + æŸ¥è¡¨åŠ é€Ÿ
- 4ms é‡‡æ ·å‘¨æœŸ (250 Hz, ä¸ä¸Šä½æœºä¸€è‡´)

### ğŸ”§ åˆ†å±‚æ€§èƒ½åˆ†æ

```cpp
// ç¢°æ’æ£€æµ‹å„é˜¶æ®µè€—æ—¶
auto stats = checker.getTimingStats();
printf("%s", stats.toString().c_str());
// è¾“å‡º: updateè€—æ—¶, è‡ªç¢°æ’è€—æ—¶, ç¯å¢ƒç¢°æ’è€—æ—¶, FKè€—æ—¶(ç‹¬ç«‹è®¡æ•°), IKè€—æ—¶(ç‹¬ç«‹è®¡æ•°)

// è§„åˆ’ç®¡çº¿å„é˜¶æ®µè€—æ—¶
auto timing = planner.getTimingReport();
printf("  è§„åˆ’: %.1f ms  ä¼˜åŒ–: %.1f ms  æ—¶é—´å‚æ•°åŒ–: %.1f ms\n",
       timing.planningTime_ms, timing.optimizationTime_ms, timing.parameterizationTime_ms);
```

---

## æ€§èƒ½æŒ‡æ ‡

### SOæ ˆæ€§èƒ½ (ç å›åœºæ™¯)

| æŒ‡æ ‡ | å®æµ‹ | éªŒè¯æµ‹è¯• |
|------|------|----------|
| IK æ±‚è§£ (12ä½ç½®) | **0.6 ms** | testTrajectoryOptimality |
| ç¢°æ’æ£€æµ‹ (5363æ¬¡) | **68.4 ms** (9.97 Î¼s/æ¬¡) | testS50PalletizingSO |
| FK å•æ¬¡è€—æ—¶ | **0.54 Î¼s** | testTrajectoryOptimality |
| ç å›å…¨é“¾è·¯è®¡ç®— (12ç®±) | **0.098 s** | testS50PalletizingSO |
| Sæ›²çº¿æ‰§è¡Œæ€»æ—¶é—´ (12ç®±) | **209.6 s** | testS50PalletizingSO |
| è§„åˆ’æˆåŠŸç‡ | **100%** | testTrajectoryOptimality |
| ç¢°æ’å®‰å…¨ç‡ | **100%** | testTrajectoryOptimality |
| æœ€å°è‡ªç¢°æ’è·ç¦» | **10.5 mm** | testS50PalletizingSO |
| è·¯å¾„ä¸€è‡´æ€§ (20æ¬¡é‡å¤) | **100%** | testTrajectoryOptimality |

### é™æ€åº“æ ˆæ€§èƒ½

| æŒ‡æ ‡ | å®æµ‹ | éªŒè¯æµ‹è¯• |
|------|------|----------|
| ç®€å•åœºæ™¯è§„åˆ’ | **0.04 ms** | testPerformanceBenchmark |
| å®Œæ•´æµæ°´çº¿ (è§„åˆ’+ä¼˜åŒ–+å‚æ•°åŒ–) | **~135 ms** | testPalletizingPlanner |
| KD-Tree åŠ é€Ÿæ¯” | **30x** | testPerformanceBenchmark |
| ç¢°æ’ç¼“å­˜åŠ é€Ÿæ¯” | **18x** | testPerformanceBenchmark |
| è§„åˆ’æˆåŠŸç‡ | **99.5%** | testRobustnessValidation |

### å½“å‰ç“¶é¢ˆ

åˆ†å±‚è®¡æ—¶æ˜¾ç¤º rewiring (findNear + é‚»åŸŸçˆ¶èŠ‚ç‚¹é€‰æ‹© + é‡è¿) å è§„åˆ’æ€»æ—¶é—´çš„ 97%ã€‚ç¢°æ’æ£€æµ‹ (77ms/43Kæ¬¡) å’Œé‡‡æ · (2ms) å·²å¾ˆå¿«ã€‚ä¼˜åŒ–æ–¹å‘ï¼š
- å‡å°‘ rewire åŠå¾„æˆ–é‚»åŸŸæ•°é‡
- å¼‚æ­¥/å»¶è¿Ÿ rewire
- æ—©æœŸç»ˆæ­¢ï¼šæ‰¾åˆ°è´¨é‡è¶³å¤Ÿå¥½çš„è§£ååœæ­¢è¿­ä»£

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

| ä¾èµ– | æœ€ä½ç‰ˆæœ¬ | è¯´æ˜ |
|------|----------|------|
| **æ“ä½œç³»ç»Ÿ** | Linux x86_64 | é¢„ç¼–è¯‘åº“ä»…æ”¯æŒæ­¤å¹³å° |
| **GCC** | 7+ | éœ€æ”¯æŒ C++17 |
| **CMake** | 3.14+ | é¡¹ç›®æ„å»ºç³»ç»Ÿ |
| **Eigen3** | 3.3+ | çº¿æ€§ä»£æ•°åº“ (`/usr/include/eigen3`) |
| **libHRCInterface.so** | â€” | SOæ ˆç¢°æ’æ£€æµ‹ (è®¾ç½® `HRC_LIB_PATH` ç¯å¢ƒå˜é‡) |

### æ„å»ºæ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/huayan-robotics/HRC-PalletizingPlanner.git
cd HRC-PalletizingPlanner

# 2. å®‰è£… Eigen3
sudo apt-get install libeigen3-dev

# 3. æ„å»º
mkdir -p build && cd build
cmake ..
make -j$(nproc)

# 4. å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºåˆ° bin/
ls ../bin/
```

### è¿è¡Œæµ‹è¯•

```bash
# â”€â”€â”€ SOæ ˆæµ‹è¯• (æ¨è, éœ€ libHRCInterface.so) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export HRC_LIB_PATH=/path/to/libHRCInterface.so

# ç å›å®Œæ•´ä»¿çœŸ (12ç®±, IK+ç¯å¢ƒç¢°æ’+åŠ¨æ€éšœç¢ç‰©)
./bin/testS50PalletizingSO

# ç¢°æ’æ£€æµ‹éªŒè¯ (7åœºæ™¯)
./bin/testS50CollisionSO

# â˜… ç³»ç»Ÿæ€§è½¨è¿¹æœ€ä¼˜æ€§æµ‹è¯• (6å¥—æµ‹è¯•)
./bin/testTrajectoryOptimality

# â”€â”€â”€ é™æ€åº“æ ˆæµ‹è¯• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ç»¼åˆåŠŸèƒ½æµ‹è¯• (7ä¸ªå­æµ‹è¯•)
./bin/testPalletizingPlanner

# æ€§èƒ½åŸºå‡†æµ‹è¯• (KD-Tree 30x / ç¼“å­˜ 18x åŠ é€ŸéªŒè¯)
./bin/testPerformanceBenchmark

# é²æ£’æ€§éªŒè¯æµ‹è¯• (1000+ éšæœºé…ç½®)
./bin/testRobustnessValidation
```

### SOæ ˆæœ€å°ç¤ºä¾‹

```cpp
#include "PalletizingPlanner/CollisionCheckerSO.hpp"
#include "PalletizingPlanner/PathPlannerSO.hpp"
using namespace palletizing;

int main() {
    // åˆ›å»ºç¢°æ’æ£€æµ‹å™¨ (è‡ªåŠ¨æœç´¢: HRC_LIB_PATH â†’ ../lib/ â†’ LD_LIBRARY_PATH)
    RobotModel robot;
    CollisionCheckerSO checker(robot);
    if (!checker.initialize()) return -1;

    // åˆ›å»ºè§„åˆ’å™¨
    PathPlannerSO planner(checker, robot);

    // IK æ±‚è§£: TCPä½å§¿ â†’ å…³èŠ‚è§’
    Pose6D targetPose;  // è®¾ç½®ç›®æ ‡ä½å§¿...
    JointConfig refConfig = JointConfig::fromDegrees({0, -90, 30, 0, -60, 0});
    std::vector<double> ikResult;
    if (checker.inverseKinematics(targetPose, refConfig, ikResult)) {
        // IK æˆåŠŸ
    }

    // è§„åˆ’: å…³èŠ‚ç©ºé—´ P2P
    JointConfig start = JointConfig::fromDegrees({0, -90, 30, 0, -60, 0});
    JointConfig goal  = JointConfig::fromDegrees({45, -60, 45, 30, -45, 45});
    auto result = planner.plan(start, goal);

    if (result.status == PlanningStatus::Success) {
        printf("è·¯å¾„é•¿åº¦: %.3f rad, è§„åˆ’æ—¶é—´: %.1f ms\n",
               result.pathLength, result.planningTime_ms);
    }
    return 0;
}
```

### é™æ€åº“æ ˆæœ€å°ç¤ºä¾‹

```cpp
#include "PalletizingPlanner/PalletizingPlanner.hpp"
using namespace palletizing;

int main() {
    PalletizingPlanner planner;
    if (!planner.initialize()) return -1;

    JointConfig start = JointConfig::fromDegrees({0, -90, 30, 0, -60, 0});
    JointConfig goal  = JointConfig::fromDegrees({45, -60, 45, 30, -45, 45});
    PlanningResult result = planner.planPointToPoint(start, goal);

    if (result.isSuccess()) {
        printf("è·¯å¾„é•¿åº¦: %.3f rad, è§„åˆ’æ—¶é—´: %.3f s\n",
               result.pathLength, result.planningTime);
    }
    return 0;
}
```

---

## API æ–‡æ¡£

### SOæ ˆæ ¸å¿ƒæ¥å£

#### CollisionCheckerSO

```cpp
class CollisionCheckerSO {
public:
    explicit CollisionCheckerSO(const RobotModel& robot);
    bool initialize();  // è‡ªåŠ¨æœç´¢ .so: HRC_LIB_PATH â†’ ../lib/ â†’ LD_LIBRARY_PATH

    // ç¢°æ’æ£€æµ‹
    bool isCollisionFree(const JointConfig& config);
    bool isPathCollisionFree(const Path& path);  // æ‰¹é‡æ£€æŸ¥, å•æ¬¡åŠ é”

    // æ­£/é€†è¿åŠ¨å­¦ (ä½ç½®: m, å§¿æ€: deg)
    bool forwardKinematics(const JointConfig& config, Pose6D& pose);
    bool inverseKinematics(const Pose6D& pose, const JointConfig& ref,
                           std::vector<double>& result);

    // ç¯å¢ƒç¢°æ’ä½“ (åŠ¨æ€æ·»åŠ /ç§»é™¤)
    void addEnvObstacleBall(int id, const Eigen::Vector3d& center_mm, double radius_mm);
    void addEnvObstacleCapsule(int id, const Eigen::Vector3d& start_mm,
                               const Eigen::Vector3d& end_mm, double radius_mm);
    void removeEnvObstacle(int id);

    // å·¥å…·ç¢°æ’çƒ
    void setToolBall(int id, const Eigen::Vector3d& offset_mm, double radius_mm);

    // æ€§èƒ½åˆ†æ
    TimingStats getTimingStats() const;  // FK/IK/ç¢°æ’ç‹¬ç«‹è®¡æ—¶
};
```

#### PathPlannerSO

```cpp
class PathPlannerSO {
public:
    PathPlannerSO(CollisionCheckerSO& checker, const RobotModel& robot);

    PlanningResult plan(const JointConfig& start, const JointConfig& goal);

    // é…ç½®
    void setMaxIterations(int n);
    void setStepSize(double rad);
    void setFreeTcpDuringTransit(bool enable);  // é»˜è®¤ true

    // æ€§èƒ½æŠ¥å‘Š
    PipelineTimingReport getTimingReport() const;
};
```

### é™æ€åº“æ ˆæ¥å£

#### PalletizingPlanner (Facade)

```cpp
class PalletizingPlanner {
public:
    explicit PalletizingPlanner(const RobotDHParams& = RobotDHParams::fromHRConfig());
    bool initialize(const SceneConfig& = SceneConfig::defaultPalletizing());

    PlanningResult planPointToPoint(const JointConfig& start, const JointConfig& goal);
    PalletizingResult planPickAndPlace(const PalletizingTask& task);
    std::vector<PalletizingResult> planTaskSequence(
        const std::vector<PalletizingTask>& tasks,
        const JointConfig& homeConfig,
        ProgressCallback callback = nullptr);

    void setConfig(const PlannerConfig& config);
    bool isConfigValid(const JointConfig& config) const;
    void savePathToFile(const Path& path, const std::string& filename) const;
};
```

### æ ¸å¿ƒæ•°æ®ç±»å‹

| ç±»å‹ | è¯´æ˜ | å…³é”®æ–¹æ³• |
|------|------|----------|
| `JointConfig` | 6DOF å…³èŠ‚é…ç½® (å†…éƒ¨ rad) | `fromDegrees()`, `toDegrees()`, `distanceTo()`, `interpolate()` |
| `JointVector` | `Eigen::Matrix<double, 6, 1>` | å†…éƒ¨è®¡ç®—ç”¨ |
| `Pose6D` | 6D ä½å§¿ (Position3D + Quaternion) | SLERP æ’å€¼, æ¬§æ‹‰è§’æ„é€  |
| `Path` | `Waypoint` åºåˆ— | `totalLength()`, `updatePathParameters()` |
| `BSpline` | B-Spline æ›²çº¿ | `evaluate(t)` â€” De Boor ç®—æ³• |
| `PlanningResult` | è§„åˆ’è¾“å‡º | `isSuccess()`, `pathLength`, `planningTime` |
| `TimingStats` | ç¢°æ’æ£€æµ‹è®¡æ—¶ | FK/IK ç‹¬ç«‹è®¡æ•°å™¨ |
| `PipelineTimingReport` | ç®¡çº¿è®¡æ—¶ | å„é˜¶æ®µè€—æ—¶åˆ†è§£ |

---

## ç¢°æ’æ£€æµ‹æ¶æ„

### SOæ ˆç¢°æ’æ£€æµ‹ (æ¨è)

```
CollisionCheckerSO
â”œâ”€â”€ dlopen("libHRCInterface.so")       â† è¿è¡Œæ—¶åŠ è½½
â”œâ”€â”€ åˆå§‹åŒ–: S50CollisionGeometry è‡ªåŠ¨é…ç½®ç¢°æ’å‚æ•°
â”œâ”€â”€ è‡ªç¢°æ’æ£€æµ‹ (4èƒ¶å›Šä½“ + 1çƒä½“)
â”œâ”€â”€ ç¯å¢ƒç¢°æ’ä½“ (åŠ¨æ€ ID ç³»ç»Ÿ)
â”‚   â”œâ”€â”€ ID 10-13: ç”µç®±4æ¡è¾¹ (èƒ¶å›Š, R=80mm)
â”‚   â”œâ”€â”€ ID 15-17: ä¼ é€å¸¦ (èƒ¶å›Š, R=80/275mm)
â”‚   â”œâ”€â”€ ID 30-33: æ¡†æ¶ç«‹æŸ± (èƒ¶å›Š, R=50mm)
â”‚   â”œâ”€â”€ ID 34-45: å·²æ”¾ç½®ç®±å­ (çƒ, R=250mm) â€” åŠ¨æ€æ›´æ–°
â”‚   â””â”€â”€ ID 6:     æ¬è¿å·¥å…· (çƒ, R=225mm) â€” åŠ¨æ€æ›´æ–°
â”œâ”€â”€ FK/IK: forwardKinematics / inverseKinematics
â””â”€â”€ TimingStats: FK/IK/ç¢°æ’ å„è‡ªç‹¬ç«‹è®¡æ—¶
```

ç¢°æ’å‡ ä½•å‚æ•°ç»Ÿä¸€å®šä¹‰åœ¨ `CollisionGeometry.hpp`ï¼š

```cpp
namespace S50CollisionGeometry {
    // èƒ¶å›Šä½“: [sx, sy, sz, ex, ey, ez, radius] (7å€¼, mm)
    // çƒä½“:   [cx, cy, cz, radius] (4å€¼, mm)
    static constexpr double capsule1[] = {...};
    // ...
}
```

### é™æ€åº“æ ˆç¢°æ’æ£€æµ‹

```
CollisionChecker
â”œâ”€â”€ extern "C" { #include <algorithmLibInterface.h> }
â”œâ”€â”€ initACAreaConstrainPackageInterface(robType=1, dh, geom)
â”œâ”€â”€ setCPSelfColliderLinkModelOpenStateInterface(true)
â”œâ”€â”€ updateACAreaConstrainPackageInterface(jointPos_deg, vel)
â”œâ”€â”€ ç¬¬ä¸€å±‚: è¿æ†-è¿æ†è‡ªç¢°æ’
â”œâ”€â”€ ç¬¬äºŒå±‚: è¿æ†-è™šæ‹Ÿå¢™ç¯å¢ƒç¢°æ’
â””â”€â”€ ç¬¬ä¸‰å±‚: TCP-å®‰å…¨åŒºåŸŸå…¥ä¾µæ£€æµ‹
```

### SOåº“è·¯å¾„æœç´¢

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ (æ¨è)
export HRC_LIB_PATH=/path/to/libHRCInterface.so

# æˆ–æ”¾åˆ°é¡¹ç›® lib/ ç›®å½•
cp libHRCInterface.so /path/to/project/lib/

# è‡ªåŠ¨æœç´¢é¡ºåº: HRC_LIB_PATH â†’ ../lib/ â†’ LD_LIBRARY_PATH
```

---

## é…ç½®ä¸è°ƒä¼˜

### SOæ ˆé…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `freeTcpDuringTransit` | `true` | è‡ªç”±TCPæ¨¡å¼ (ç å›åœºæ™¯æ¨è) |
| `maxIterations` | 10,000 | RRT* æœ€å¤§è¿­ä»£ |
| `stepSize` | 0.2 rad | é‡‡æ ·æ­¥é•¿ |
| `goalBias` | 0.10 | ç›®æ ‡åå‘ |
| `rewireRadius` | 1.0 rad | é‡è¿åŠå¾„ |

### é™æ€åº“æ ˆé…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `plannerType` | `InformedRRTStar` | ç®—æ³•é€‰æ‹© |
| `useLazyCollision` | `true` | æ‡’æƒ°ç¢°æ’æ£€æµ‹ |
| `useCache` | `true` | FNV-1a + LRU ç¼“å­˜ |
| `useKDTree` | `true` | KD-Tree åŠ é€Ÿ |

### Sæ›²çº¿å‚æ•° (libCmpRML.so)

| å‚æ•° | J1-J3 | J4-J6 | å•ä½ |
|------|-------|-------|------|
| æœ€å¤§é€Ÿåº¦ | 120 | 180 | Â°/s |
| æœ€å¤§åŠ é€Ÿåº¦ | 121 | 121 | Â°/sÂ² |
| æœ€å¤§ Jerk | 860 | 860 | Â°/sÂ³ |
| é‡‡æ ·å‘¨æœŸ | 4 | 4 | ms |

---

## æµ‹è¯•éªŒè¯

### SOæ ˆæµ‹è¯• (éœ€ `HRC_LIB_PATH`)

| æµ‹è¯•ç¨‹åº | è¯´æ˜ | ç»“æœ |
|----------|------|------|
| `testS50PalletizingSO` | 12ç®±ç å›å®Œæ•´ä»¿çœŸ (IK+ç¯å¢ƒç¢°æ’+åŠ¨æ€éšœç¢ç‰©) | 12/12 âœ…, 0ç¢°æ’ |
| `testS50CollisionSO` | 7åœºæ™¯ç¢°æ’æ£€æµ‹ (å®‰å…¨/ç¢°æ’/æé™) | 7/7 âœ… |
| `testTrajectoryOptimality` | â˜… ç³»ç»Ÿæ€§æµ‹è¯• (è¿åŠ¨å­¦/P2P/TCPå…¨é“¾/ç¯å¢ƒç¢°æ’/å®‰å…¨è·ç¦»/é‡å¤æ€§) | 6/6 âœ…, 20/20 é‡å¤ |

### é™æ€åº“æ ˆæµ‹è¯•

| æµ‹è¯•ç¨‹åº | è¯´æ˜ | ç»“æœ |
|----------|------|------|
| `testPalletizingPlanner` | ç»¼åˆåŠŸèƒ½ (7å­æµ‹è¯•: è¿åŠ¨å­¦/ç¢°æ’/RRT*/ä¼˜åŒ–/Sæ›²çº¿/BIT*/ç å›) | 7/7 âœ… |
| `testPerformanceBenchmark` | KD-Tree 30x / ç¼“å­˜ 18x åŠ é€ŸéªŒè¯ | âœ… |
| `testRobustnessValidation` | 1000+ éšæœºé…ç½®, 99.5% æˆåŠŸç‡ | âœ… |
| `testHighPerformance` | ä¼˜åŒ–å‰åå¯¹æ¯”, å…¨æµæ°´çº¿ | âœ… |
| `testCollisionDetectionTime` | HRCåº“ CPU/å†…å­˜/å †æ ˆèµ„æºåˆ†æ | âœ… |

### æµ‹è¯•ç¼–å†™è§„èŒƒ

æ— æµ‹è¯•æ¡†æ¶ï¼Œæ¯ä¸ªæµ‹è¯•æ˜¯ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶ï¼š

```cpp
int main() {
    try {
        testFoo();  // void testXxx() å‘½å
    } catch (const std::exception& e) {
        std::cerr << "å¼‚å¸¸: " << e.what() << "\n";
        return 1;
    }
    return 0;
}
```

æ–°å¢æµ‹è¯•éœ€åœ¨ `test/CMakeLists.txt` æ·»åŠ ï¼š
- **SOæ ˆ**: é“¾æ¥ `stdc++ m pthread dl` (è¿è¡Œæ—¶ dlopen)
- **é™æ€åº“æ ˆ**: ä¸¥æ ¼é¡ºåº `libHRCInterface.a â†’ libCmpAgu.a â†’ libhansKinematics.a â†’ stdc++ â†’ m [â†’ pthread]`

---

## æŠ€æœ¯è§„æ ¼

### HR_S50-2000 å‚æ•°

| å‚æ•° | å€¼ | å•ä½ |
|------|-----|------|
| è‡ªç”±åº¦ | 6 | DOF |
| æœ€å¤§è´Ÿè½½ | 50 | kg |
| è‡‚å±• | 2000 | mm |
| é‡å¤å®šä½ç²¾åº¦ | Â±0.05 | mm |

### DH å‚æ•° (mm)

| d1 | d2 | d3 | d4 | d5 | d6 | a2 | a3 |
|---|---|---|---|---|---|---|---|
| 296.5 | 336.2 | 239.0 | 158.5 | 158.5 | 134.5 | 900.0 | 941.5 |

### å…³èŠ‚é™ä½ (deg)

| | J1 | J2 | J3 | J4 | J5 | J6 |
|---|---|---|---|---|---|---|
| Min | -360 | -190 | -165 | -360 | -360 | -360 |
| Max | +360 | +10 | +165 | +360 | +360 | +360 |
| æœ€å¤§é€Ÿåº¦ (Â°/s) | 120 | 120 | 120 | 180 | 180 | 180 |

---

## ç›®å½•ç»“æ„

```
HRC-PalletizingPlanner/
â”œâ”€â”€ CMakeLists.txt                  # CMake 3.14+, C++17, -Wall -Wextra
â”œâ”€â”€ README.md
â”œâ”€â”€ CHANGELOG.md
â”œâ”€â”€ CONTRIBUTING.md
â”œâ”€â”€ LICENSE                         # MIT
â”œâ”€â”€ HR_S50-2000.hard                # å®Œæ•´ç¡¬ä»¶é…ç½®
â”‚
â”œâ”€â”€ include/PalletizingPlanner/     # â˜… Header-Only C++17 (18æ–‡ä»¶, ~9,600è¡Œ)
â”‚   â”‚
â”‚   â”‚  â”€â”€ SOæ ˆ (æ¨è) â”€â”€
â”‚   â”œâ”€â”€ CollisionCheckerSO.hpp      #  726è¡Œ â€” dlopenç¢°æ’æ£€æµ‹ (FK/IK/ç¯å¢ƒç¢°æ’/TimingStats)
â”‚   â”œâ”€â”€ PathPlannerSO.hpp           #  913è¡Œ â€” Free-TCP Informed RRT* + IncrementalKDTree6D
â”‚   â”œâ”€â”€ CollisionGeometry.hpp       #   70è¡Œ â€” ç»Ÿä¸€S50ç¢°æ’åŒ…ç»œå‚æ•°
â”‚   â”‚
â”‚   â”‚  â”€â”€ å…±äº«æ¨¡å— â”€â”€
â”‚   â”œâ”€â”€ Types.hpp                   #  487è¡Œ â€” æ ¸å¿ƒç±»å‹ (JointConfig/Path/BSpline/PlanningResult)
â”‚   â”œâ”€â”€ RobotModel.hpp              #  329è¡Œ â€” DHæ­£è¿åŠ¨å­¦/Jacobian/å…³èŠ‚é™ä½
â”‚   â”œâ”€â”€ PathOptimizer.hpp           #  460è¡Œ â€” B-Splineè·¯å¾„å¹³æ»‘ (De Boor)
â”‚   â”œâ”€â”€ TimeParameterization.hpp    #  430è¡Œ â€” å†…ç½®Sæ›²çº¿
â”‚   â”‚
â”‚   â”‚  â”€â”€ é™æ€åº“æ ˆ (å‘åå…¼å®¹) â”€â”€
â”‚   â”œâ”€â”€ PalletizingPlanner.hpp      #  418è¡Œ â€” é¡¶å±‚Facade API
â”‚   â”œâ”€â”€ CollisionChecker.hpp        #  901è¡Œ â€” extern "C" ä¸‰å±‚ç¢°æ’æ£€æµ‹
â”‚   â”œâ”€â”€ PathPlannerOptimized.hpp    #  862è¡Œ â€” KDTree+ç¼“å­˜ä¼˜åŒ–RRT*
â”‚   â”œâ”€â”€ PathOptimizerOptimized.hpp  #  649è¡Œ â€” å¢é‡B-Spline
â”‚   â”œâ”€â”€ TimeParameterizationOptimized.hpp  # 480è¡Œ â€” Sæ›²çº¿æŸ¥è¡¨åŠ é€Ÿ
â”‚   â”œâ”€â”€ CollisionCache.hpp          #  342è¡Œ â€” FNV-1a + LRU
â”‚   â”œâ”€â”€ KDTree.hpp                  #  293è¡Œ â€” 6Dæ‰¹é‡KD-Tree
â”‚   â”œâ”€â”€ HighPerformancePlanner.hpp  #  532è¡Œ â€” å…¨ä¼˜åŒ–æµæ°´çº¿
â”‚   â”œâ”€â”€ ParallelPathPlanner.hpp     #  558è¡Œ â€” v3.0è¶…é«˜æ€§èƒ½
â”‚   â”œâ”€â”€ PathPlanner.hpp             #  702è¡Œ â€” åŸºç¡€RRT*
â”‚   â””â”€â”€ TaskSequencer.hpp           #  457è¡Œ â€” TSP 2-opt
â”‚
â”œâ”€â”€ HRCInterface/                   # HRC Cæ¥å£å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ algorithmLibInterface.h
â”‚   â”œâ”€â”€ InterfaceDataStruct.h
â”‚   â””â”€â”€ stack_utils.h
â”‚
â”œâ”€â”€ lib/                            # é¢„ç¼–è¯‘åº“ (.a é™æ€åº“)
â”‚   â”œâ”€â”€ libHRCInterface.a
â”‚   â”œâ”€â”€ libCmpAgu.a
â”‚   â””â”€â”€ libhansKinematics.a
â”‚
â”œâ”€â”€ test/                           # æµ‹è¯•ç¨‹åº (13ä¸ª)
â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”œâ”€â”€ testS50PalletizingSO.cpp    # â˜… SOæ ˆç å›ä»¿çœŸ (12ç®±)
â”‚   â”œâ”€â”€ testS50CollisionSO.cpp      # â˜… SOæ ˆç¢°æ’æ£€æµ‹ (7åœºæ™¯)
â”‚   â”œâ”€â”€ testTrajectoryOptimality.cpp # â˜… ç³»ç»Ÿæ€§è½¨è¿¹æµ‹è¯• (6å¥—)
â”‚   â”œâ”€â”€ testPalletizingPlanner.cpp   # é™æ€åº“ç»¼åˆæµ‹è¯•
â”‚   â”œâ”€â”€ testPerformanceBenchmark.cpp
â”‚   â”œâ”€â”€ testRobustnessValidation.cpp
â”‚   â”œâ”€â”€ testHighPerformance.cpp
â”‚   â”œâ”€â”€ testCollisionDetectionTime.cpp
â”‚   â”œâ”€â”€ testCollisionSimulation.cpp
â”‚   â”œâ”€â”€ testS50PalletizingRML.cpp
â”‚   â”œâ”€â”€ testS50CollisionRML.cpp
â”‚   â”œâ”€â”€ testPalletizingScenarioRML.cpp
â”‚   â””â”€â”€ testRMLProbe.cpp
â”‚
â”œâ”€â”€ examples/                       # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ basic_planning_example.cpp
â”‚   â””â”€â”€ palletizing_example.cpp
â”‚
â”œâ”€â”€ scripts/                        # Python å¯è§†åŒ– (5ä¸ª)
â”‚   â”œâ”€â”€ visualize_s50_stl.py        #  589è¡Œ â€” STLç½‘æ ¼3Dæ¸²æŸ“ + ç¢°æ’è·ç¦»æ›²çº¿
â”‚   â”œâ”€â”€ visualize_scene.py          #  674è¡Œ â€” å®Œæ•´ç å›å·¥ä½œç«™æ¸²æŸ“
â”‚   â”œâ”€â”€ visualize_palletizing.py    #  296è¡Œ â€” ç å›è·¯å¾„åŠ¨ç”» (FuncAnimation)
â”‚   â”œâ”€â”€ visualize_path.py           #  203è¡Œ â€” è·¯å¾„å¯¹æ¯” (åŸå§‹ vs B-Spline)
â”‚   â””â”€â”€ visualize_trajectory.py     #  159è¡Œ â€” å¸¦éšœç¢ç‰©è½¨è¿¹å¯è§†åŒ–
â”‚
â”œâ”€â”€ ArmCollisionModel/              # MATLAB ä»¿çœŸæ¨¡å—
â”‚   â”œâ”€â”€ testS50_Palletizing_v15.m   # â˜… ç å›å·¥ä½œç«™ä»¿çœŸ v15.0 (~1,900è¡Œ)
â”‚   â”œâ”€â”€ testS50_Dynamic.m           #   åŠ¨æ€è½¨è¿¹åŠ¨ç”»
â”‚   â”œâ”€â”€ testS50.m                   #   é™æ€ç¢°æ’æµ‹è¯•
â”‚   â”œâ”€â”€ s50_collision_matlab.h      #   .so MEXæ¥å£
â”‚   â”œâ”€â”€ @RobotCollisionModel/       #   æœºå™¨äººå¯è§†åŒ–ç±»
â”‚   â”œâ”€â”€ model/meshes/S50/           #   7ä¸ªSTLæ–‡ä»¶ (base+link1-6)
â”‚   â””â”€â”€ pic/                        #   è¾“å‡ºå›¾åƒ
â”‚
â”œâ”€â”€ S50_ros2/                       # ROS2 URDF + STL æ¨¡å‹
â”œâ”€â”€ robotModel/                     # ç‹¬ç«‹è¿åŠ¨å­¦æ¨¡å‹
â”œâ”€â”€ docs/                           # æ–‡æ¡£
â”œâ”€â”€ data/                           # è¿è¡Œæ—¶æ•°æ®è¾“å‡º (gitignored)
â”œâ”€â”€ build/                          # æ„å»ºä¸­é—´äº§ç‰©
â””â”€â”€ bin/                            # å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡º
```

---

## MATLAB ä»¿çœŸéªŒè¯

### æ ¸å¿ƒå·¥ä½œæµ

1. C++ è§„åˆ’ â†’ è¾“å‡ºè½¨è¿¹åˆ° `data/so_palletizing_trajectory.txt`
2. MATLAB åŠ è½½è½¨è¿¹ â†’ STL ç½‘æ ¼ç²¾ç¡®å¯è§†åŒ– + `urdfFK()` æ­£è¿åŠ¨å­¦é“¾
3. `libHRCInterface.so` å®æ—¶ç¢°æ’è·ç¦»éªŒè¯ â†’ .so vs C++ äº¤å‰æ£€éªŒ
4. 3D åŠ¨ç”»ç”Ÿæˆ â†’ GIF / PNG åºåˆ—

### ç å›ä»¿çœŸ v15.0

**`testS50_Palletizing_v15.m`** (~1,900è¡Œ) å®ç°å®Œæ•´ç å›å·¥ä½œç«™ä»¿çœŸï¼š

#### åœºæ™¯å¸ƒå±€ (mm, æœºå™¨äººåŸºåº§åæ ‡ç³»)

```
         +Y (é‡Œ)
          â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚            â”‚     æ¡†æ¶ (1200Ã—650Ã—2000)    â”‚
          â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚            â”‚  â”‚BK-L     â”‚  â”‚BK-R     â”‚  â”‚
          â”‚            â”‚  â”‚ L1â†’L2â†’L3â”‚  â”‚ L1â†’L2â†’L3â”‚  â”‚
          â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚            â”‚  â”‚FR-L     â”‚  â”‚FR-R     â”‚  â”‚
          â”‚            â”‚  â”‚ L1â†’L2â†’L3â”‚  â”‚ L1â†’L2â†’L3â”‚  â”‚
          â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€[ROBOT]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ +X
          â”‚  (0,0,800)
     â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
     â”‚ ç”µç®±     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       ä¼ é€å¸¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
```

#### ç å›é¡ºåº
**åˆ—ä¼˜å…ˆ**: é‡Œâ†’å¤–(BKâ†’FR), å·¦â†’å³(Lâ†’R), ä¸‹â†’ä¸Š(L1â†’L3)

#### STLå¯è§†åŒ– vs ç¢°æ’ä½“

| å±‚æ¬¡ | ç”¨é€” | æ¨¡å‹ |
|------|------|------|
| STLç½‘æ ¼ | 3Dæ¸²æŸ“/åŠ¨ç”» | `model/meshes/S50/` (73Ké¢â†’22Ké™é¢) |
| ç¢°æ’èƒ¶å›Šä½“ | ç¢°æ’æ£€æµ‹ | `CollisionGeometry.hpp` (4èƒ¶å›Š+1çƒ) |
| ç¯å¢ƒç¢°æ’ä½“ | ç¯å¢ƒç¢°æ’ | èƒ¶å›Š/çƒ (ç”µç®±+ä¼ é€å¸¦+æ¡†æ¶+å·²æ”¾ç®±) |

### SO_PATH é…ç½®

MATLAB v15 è‡ªåŠ¨æœç´¢ `libHRCInterface.so`ï¼š

```matlab
% æœç´¢é¡ºåº: HRC_LIB_PATHç¯å¢ƒå˜é‡ â†’ é¡¹ç›®lib/ â†’ ç¡¬ç¼–ç è·¯å¾„
SO_PATH = getenv('HRC_LIB_PATH');
if isempty(SO_PATH)
    projLib = fullfile(fileparts(mfilename('fullpath')), '..', 'lib', 'libHRCInterface.so');
    if exist(projLib, 'file'), SO_PATH = projLib; end
end
```

### è¿è¡Œæ–¹å¼

```bash
export HRC_LIB_PATH=/path/to/libHRCInterface.so
cd ArmCollisionModel
matlab -nodesktop -nosplash -batch "testS50_Palletizing_v15"
```

---

## Python å¯è§†åŒ–å·¥å…·

### è„šæœ¬ä¸€è§ˆ

| è„šæœ¬ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `visualize_s50_stl.py` | 589 | STLç½‘æ ¼3Dæ¸²æŸ“ + RMLç¢°æ’è·ç¦»æ›²çº¿ |
| `visualize_scene.py` | 674 | å®Œæ•´ç å›å·¥ä½œç«™æ¸²æŸ“ (ç¢°æ’æ¨¡å‹) |
| `visualize_palletizing.py` | 296 | ç å›è·¯å¾„ FuncAnimation åŠ¨ç”» |
| `visualize_path.py` | 203 | è·¯å¾„å¯¹æ¯” (åŸå§‹ vs B-Spline) |
| `visualize_trajectory.py` | 159 | å¸¦éšœç¢ç‰©è½¨è¿¹å¯è§†åŒ– |

### å®‰è£…

```bash
pip install numpy matplotlib
pip install pyvista  # å¯é€‰: é«˜è´¨é‡æ¸²æŸ“
```

### DH å‚æ•°åŒæ­¥

æ¯ä¸ª Python è„šæœ¬ç‹¬ç«‹å®šä¹‰ DH å‚æ•°å’Œ `fk_s50()` å‡½æ•°ã€‚ä¿®æ”¹ DH å‚æ•°æ—¶éœ€åŒæ­¥ï¼š
- `RobotModel.hpp`
- `scripts/*.py`
- `model/collideConfig/*.json`

---

## æ•°æ®æ–‡ä»¶æ ¼å¼è§„èŒƒ

| æ ¼å¼ | åˆ—æ•° | å•ä½ | ç”¨é€” |
|------|------|------|------|
| è·¯å¾„æ–‡ä»¶ `.txt` | 6 | rad | å…³èŠ‚ç©ºé—´è·¯å¾„ |
| è½¨è¿¹æ–‡ä»¶ `.txt` | 13 | rad + rad/s | æ—¶é—´+ä½ç½®+é€Ÿåº¦ |
| ä»¿çœŸ CSV | 19 | deg + deg/s + deg/sÂ² | 250Hz é‡‡æ ·è½¨è¿¹ |
| ç¢°æ’ profile CSV | 14+ | deg, mm | ç¢°æ’è·ç¦»æ›²çº¿ |

é€šç”¨çº¦å®šï¼šç©ºæ ¼åˆ†éš” (`.txt`) æˆ–é€—å· (`.csv`)ï¼Œ`#` æ³¨é‡Šå¤´æ ‡æ˜æ ¼å¼å’Œå•ä½ï¼Œè¾“å‡ºåˆ° `data/`ã€‚

---

## å¼€å‘æŒ‡å—

### C++ ä»£ç è§„èŒƒ

| è§„åˆ™ | ç¤ºä¾‹ |
|------|------|
| å‘½åç©ºé—´ | `palletizing` |
| ç±»å | PascalCase: `PathPlannerSO` |
| æ–¹æ³•å | camelCase: `isCollisionFree()` |
| æˆå‘˜å˜é‡ | `trailing_underscore_`: `robot_`, `timing_` |
| ç»“æ„ä½“å­—æ®µ | camelCase æ— ä¸‹åˆ’çº¿: `maxIterations` |
| å¤´æ–‡ä»¶ | `#pragma once`, Doxygen (`@file`, `@brief`) |
| é”™è¯¯å¤„ç† | **æ— å¼‚å¸¸** â€” è¿”å›å€¼ (`PlanningResult.status` + `errorMessage`) |
| æ³¨é‡Š | ä¸­æ–‡æ³¨é‡Š |

### CMake é“¾æ¥é…ç½®

```cmake
# SOæ ˆ (è¿è¡Œæ—¶ dlopen)
target_link_libraries(myTest stdc++ m pthread dl)

# é™æ€åº“æ ˆ (ä¸¥æ ¼é¡ºåº!)
target_link_libraries(myTest
  libHRCInterface.a libCmpAgu.a libhansKinematics.a stdc++ m pthread)
```

---

## è°ƒè¯•ä¸æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³ |
|------|------|------|
| å•ä½é”™è¯¯ | `config.q[i]=90` (åº”ä¸ºrad) | ä½¿ç”¨ `JointConfig::fromDegrees()` |
| SOåŠ è½½å¤±è´¥ | æ‰¾ä¸åˆ° .so | è®¾ç½® `HRC_LIB_PATH` ç¯å¢ƒå˜é‡ |
| é™æ€åº“é“¾æ¥é”™è¯¯ | é“¾æ¥é¡ºåºä¸å¯¹ | æŒ‰ `HRCâ†’Aguâ†’Kinâ†’stdc++â†’m` é¡ºåº |
| FKè¾“å‡ºå•ä½ | ä½ç½®æ˜¯ m ä¸æ˜¯ mm | è§å•ä½çº¦å®šè¡¨ |
| "---1---" è¾“å‡º | HRCåº“å†…éƒ¨è°ƒè¯•ä¿¡æ¯ | `2>/dev/null` æŠ‘åˆ¶ |
| MATLABæ‰¾ä¸åˆ°URDF | å·¥ä½œç›®å½•é”™è¯¯ | `cd ArmCollisionModel && addpath(genpath('.'))` |

### æ€§èƒ½è°ƒè¯•

```bash
# SOæ ˆ: ä½¿ç”¨ TimingStats + PipelineTimingReport åˆ†å±‚åˆ†æ
HRC_LIB_PATH=/path/to/so ./bin/testTrajectoryOptimality

# é™æ€åº“æ ˆ: åŸºå‡† â†’ å¯¹æ¯” â†’ èµ„æºåˆ†æ
./bin/testPerformanceBenchmark
./bin/testHighPerformance
./bin/testCollisionDetectionTime
```

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| 3.0.0 | 2026-02-12 | â˜… SOåŠ¨æ€åº“æ¶æ„ã€è‡ªç”±TCPæ¨¡å¼ã€IKæ±‚è§£å™¨ã€ç¯å¢ƒç¢°æ’ä½“ã€ä»£ç å®¡è®¡ä¿®å¤ |
| 2.1.0 | 2026-02-09 | ä»£ç è´¨é‡å‡çº§: mt19937ã€int32_tã€é”ä¼˜åŒ– |
| 2.0.0 | 2026-02-05 | ç å›å·¥ä½œç«™ä»¿çœŸ v7.0 |
| 1.4.0 | 2026-02-04 | Python 3D åœºæ™¯å¯è§†åŒ– |
| 1.3.1 | 2026-01-30 | åŠ¨æ€ç¢°æ’åŠ¨ç”»ã€æ— å¤´æ¨¡å¼ |
| 1.3.0 | 2026-01-30 | MATLAB ç¢°æ’å¯è§†åŒ–æ¨¡å— |
| 1.2.0 | 2026-02-01 | é¡¹ç›®ç»“æ„ä¼˜åŒ–ã€CI/CD |
| 1.1.0 | 2026-01-29 | KD-Tree 30x + ç¼“å­˜ 18x åŠ é€Ÿ |
| 1.0.0 | 2026-01-29 | åˆå§‹ç‰ˆæœ¬ |

---

## ä¾èµ–è¯´æ˜

### å¤–éƒ¨ä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | å¿…éœ€ | å®‰è£… | ç”¨é€” |
|------|------|------|------|------|
| Eigen3 | 3.3+ | âœ… | `apt install libeigen3-dev` | çº¿æ€§ä»£æ•°/å››å…ƒæ•° |
| pthread | â€” | å¯é€‰ | ç³»ç»Ÿè‡ªå¸¦ | å¤šçº¿ç¨‹è§„åˆ’ |

### MATLAB ä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| MATLAB | R2019b+ | ç¢°æ’æ¨¡å‹å¯è§†åŒ– |

### Python ä¾èµ–

```bash
pip install numpy matplotlib         # å¿…éœ€
pip install pyvista                   # å¯é€‰: é«˜è´¨é‡ 3D æ¸²æŸ“
```

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚

HRC ç¢°æ’æ£€æµ‹åº“ (`libHRCInterface.so`/`.a`, `libCmpAgu.a`, `libhansKinematics.a`) ä¸ºå¹¿ä¸œåæ²¿æœºå™¨äººæœ‰é™å…¬å¸ä¸“æœ‰è½¯ä»¶ã€‚

---

## è”ç³»æ–¹å¼

| æ¸ é“ | è”ç³»æ–¹å¼ |
|------|----------|
| ğŸ“§ æŠ€æœ¯æ”¯æŒ | yuesj@huayan-robotics.com |
| ğŸ“§ å•†åŠ¡åˆä½œ | marketing@huayan-robotics.com |
| ğŸ“ å’¨è¯¢çƒ­çº¿ | 400-852-9898 |
| ğŸŒ å®˜æ–¹ç½‘ç«™ | https://www.huayan-robotics.com |
| ğŸ› Issues | [GitHub Issues](https://github.com/huayan-robotics/HRC-PalletizingPlanner/issues) |

---

<p align="center">
  <b>å¹¿ä¸œåæ²¿æœºå™¨äººæœ‰é™å…¬å¸ | Guangdong Huayan Robotics Co., Ltd.</b><br>
  <i>ç”¨æœºå™¨äººæŠ€æœ¯ä¸ºäººç±»æœåŠ¡</i>
</p>
