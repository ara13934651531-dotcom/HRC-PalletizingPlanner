# 🤖 HRC 码垛轨迹规划库 — 迭代开发计划

> **广东华沿机器人有限公司** | HR_S50-2000 码垛运动规划 `.so` 库
> **交付截止**: **2026-03-31 (4月前)** | 

---

## 📋 目录

- [一、项目定位与交付边界](#一项目定位与交付边界)
- [二、项目现状评估](#二项目现状评估)
- [三、核心差距分析](#三核心差距分析)
- [四、2026年2-3月工作日](#四2026年2-3月真实日历与工作日)
- [五、迭代计划总览](#五迭代计划总览)
- [六、Sprint 详细计划](#六sprint-详细计划)
  - [Phase 1: 碰撞方案验证 + IK设计启动 (节前3天冲刺)](#phase-1-碰撞方案验证--ik设计启动-节前3天冲刺)
  - [Phase 2: IK完成 + 碰撞完善 + 代码精简 (节后)](#phase-2-ik完成--碰撞完善--代码精简-节后)
  - [Phase 3: .so库封装 + 测试 + 交付 (全力冲刺)](#phase-3-so库封装--测试--交付-全力冲刺)
- [七、风险登记簿](#七风险登记簿)
- [八、验收标准](#八验收标准)

---

## 一、项目定位与交付边界

### 1.1 交付目标

**输出产物**: `libPalletizingPlanner.so` 共享库 + 头文件 + 使用文档
**硬性截止**: **2026年3月31日 (周二)** — 4月开始前交付完毕

**调用方式**: 调用方传入起始/目标关节位置 + 环境障碍物配置 + 规划参数 → 库返回无碰撞最优轨迹（关节角序列）

```cpp
// 调用方伪代码示例
#include <PalletizingPlanner/PlannerAPI.h>

PlannerHandle planner = pp_create(robot_config);
pp_set_scene(planner, obstacles, num_obstacles);
pp_set_params(planner, &params);

TrajectoryResult result;
int ret = pp_plan(planner, start_joints, goal_joints, &result);
// result.positions[i][6]  — 第i个路径点的6个关节角 (rad)
// result.num_points       — 路径点数量
// result.path_length      — 路径总长度
// result.planning_time_ms — 规划耗时

pp_destroy(planner);
```

### 1.2 明确的任务边界

| 范围       | 本项目负责 ✅                             | 其他团队负责 ❌               |
| ---------- | ----------------------------------------- | ----------------------------- |
| 路径规划   | Informed RRT* / BIT* 无碰撞路径           | —                            |
| 路径优化   | B-Spline平滑 + 快捷径优化                 | —                            |
| 碰撞检测   | 自碰撞 +**连杆-环境碰撞** + TCP区域 | —                            |
| 逆运动学   | 解析IK 8解 + 最优解选择                   | —                            |
| 轨迹输出   | 关节角序列 (rad)                          | —                            |
| .so库封装  | C API + 线程安全                          | —                            |
| 时间参数化 | 提供S-curve/梯形接口（可选使用）          | 调用方决定用TOPP/恒速/S-curve |
| 轨迹执行   | —                                        | 控制器团队                    |
| 通信协议   | —                                        | 控制器团队                    |
| 夹爪控制   | —                                        | 硬件团队                      |
| HMI界面    | —                                        | 软件团队                      |
| 安全监控   | —                                        | 安全团队                      |
| 实时伺服   | —                                        | 控制器团队                    |

### 1.3 库接口契约

**输入**:

- 起始关节角 `double start[6]` (rad)
- 目标关节角 `double goal[6]` (rad)
- 或: 目标笛卡尔位姿 `double pose[6]` (x,y,z mm + rx,ry,rz rad) → 内部IK求解
- 障碍物列表: OBB (位姿+长宽高) / 安全平面 (位姿)
- 规划参数: 最大规划时间、步长、安全余量等

**输出**:

- 无碰撞路径点序列 `double path[N][6]` (rad)
- B-Spline平滑后的采样轨迹 (可选)
- 规划状态 (成功/失败/超时/原因)
- 性能统计 (耗时/迭代次数/路径长度)

---

## 二、项目现状评估

### 2.1 模块完成度

| 模块           | 文件                                  | 状态          | 生产就绪   | 核心问题                      |
| -------------- | ------------------------------------- | ------------- | ---------- | ----------------------------- |
| 核心类型       | `Types.hpp`                         | ✅ 完整       | ★★★★☆ | —                            |
| 机器人模型     | `RobotModel.hpp`                    | ⚠️ 部分     | ★★☆☆☆ | **无IK**                |
| 碰撞检测       | `CollisionChecker.hpp`              | ⚠️ 关键缺失 | ★★☆☆☆ | **连杆-环境碰撞不完整** |
| 碰撞缓存       | `CollisionCache.hpp`                | ✅ 完整       | ★★★★☆ | 18x加速                       |
| KD-Tree        | `KDTree.hpp`                        | ✅ 完整       | ★★★★☆ | 30x加速                       |
| 路径规划(优化) | `PathPlannerOptimized.hpp`          | ✅ 主力       | ★★★★☆ | —                            |
| 路径规划(基础) | `PathPlanner.hpp`                   | ⚠️ 冗余     | —         | 应合并删除                    |
| 并行规划       | `ParallelPathPlanner.hpp`           | ❌ 无效       | —         | 应删除                        |
| 路径优化       | `PathOptimizerOptimized.hpp`        | ✅ 主力       | ★★★★☆ | —                            |
| 时间参数化     | `TimeParameterizationOptimized.hpp` | ✅ 可选       | ★★★★☆ | 调用方决定是否使用            |
| 高性能Pipeline | `HighPerformancePlanner.hpp`        | ✅ 完整       | ★★★★☆ | —                            |
| 任务序列       | `TaskSequencer.hpp`                 | ⚠️ 受限     | ★★☆☆☆ | 因缺IK功能受限                |
| 顶层API        | `PalletizingPlanner.hpp`            | ⚠️ 受限     | ★★★☆☆ | 笛卡尔偏移用关节近似          |

### 2.2 已达标性能指标

| 指标         | 目标     | 实测             | 状态 |
| ------------ | -------- | ---------------- | ---- |
| 完整Pipeline | < 500 ms | **135 ms** | ✅   |
| KD-Tree 加速 | > 10x    | **30x**    | ✅   |
| 碰撞缓存加速 | > 5x     | **18x**    | ✅   |
| 规划成功率   | > 95%    | **99.5%**  | ✅   |

---

## 三、核心差距分析

### 3.1 连杆-环境碰撞检测 — 🔴 关键缺失 (重点开发)

**当前实现分析** (`CollisionChecker.hpp` 833行):

```
碰撞检测三层架构:
├── 第1层: 自碰撞 — checkCPSelfCollisionInterface() ✅ 完整
│   └── 所有连杆对距离检查，返回最小距离
├── 第2层: TCP区域入侵 — getACTCPInAreaListInterface() ✅ 但仅检查TCP点
│   └── 只检查TCP末端是否在OBB/安全平面区域内
│   └── ❌ 不检查机械臂连杆本体是否与环境碰撞
└── 第3层: 连杆-虚拟墙 — setCPSelfColliderLinkModelOpenStateInterface() ⚠️ 部分
    └── 已启用 (elbow/wrist/tool) → 通过checkCPSelfCollision返回
    └── ❌ 无法区分是自碰撞还是连杆-环境碰撞
    └── ❌ 没有独立的连杆-环境最小距离度量
    └── ❌ 仅检查 elbow/wrist/tool 三段，不含 base/lowerArm/upperArm
```

**关键问题**:

1. `isCollisionFree()` 虽启用了连杆-虚拟墙，但碰撞报告无法区分碰撞源（自碰撞 vs 连杆-环境）
2. 连杆-环境碰撞只有 3 段连杆参与（elbow/wrist/tool），遗漏 base/lowerArm/upperArm
3. 无独立的连杆到OBB/安全平面的距离查询，无法做梯度式安全余量
4. OBB障碍物上限硬编码5个（ID 8-12），大规模码垛场景可能不够
5. 碰撞缓存在场景变更时需要正确清空，当前无自动化机制

**HRC库可用但未充分利用的接口**:

- `getACRelativeMotionInfoInterface(id)` — TCP到指定区域的距离+运动趋势 ← 已封装但未用于碰撞判定
- `getACTCPInAreaStatusInterface(id)` — TCP是否在某区域内 ← 已封装
- `setStopPredictionTypeInterface()` — 停止预测类型 ← 完全未使用
- `setDepthThresholdForDampingAreaInterface()` — 阻尼区域距离阈值 ← 完全未使用

### 3.2 逆运动学 — 🔴 关键缺失

**现状**: 完全没有IK。`TaskSequencer` 用硬编码角度近似，`PalletizingPlanner::generateKeyConfigs()` 用关节空间近似笛卡尔偏移。

**影响**: 调用方如果以笛卡尔位姿指定抓取/放置位置（码垛场景常见），库无法处理。

### 3.3 代码冗余 — 🟡 影响维护

三套规划器(2113行)、两套优化器(1104行)、两套时间参数化(~926行) — 需合并为单套。

### 3.4 缺少 .so 构建 — 🟡 交付阻塞

当前 CMake 只构建可执行文件，无共享库目标。需要:

- 稳定的 C API 头文件
- 符号可见性控制 (`__attribute__((visibility("default")))`)
- ABI兼容性保证

---

## 四、2026年2-3月日历与工作日

### 4.1 真实日历 (系统 `cal` 命令验证)

```
       二月 2026                 三月 2026
日 一 二 三 四 五 六      日 一 二 三 四 五 六
 1  2  3  4  5  6  7       1  2  3  4  5  6  7
 8  9 10 11 12 13 14       8  9 10 11 12 13 14
15 16 17 18 19 20 21      15 16 17 18 19 20 21
22 23 24 25 26 27 28      22 23 24 25 26 27 28
                          29 30 31
```

### 4.2 法定节假日

| 节假日           | 休假日期                                | 说明                                    |
| ---------------- | --------------------------------------- | --------------------------------------- |
| 🧧**春节** | **2月12日(周四) ~ 2月23日(周一)** | 12天连休；2月11日(周三)为节前最后工作日 |

> ⚠️ 无调休补班日（2月14日/28日均为正常周末休息）

### 4.3 逐日工作日计算

**2月 (从2月9日起):**

| 周 | 一          | 二           | 三           | 四           | 五           | 六   | 日   | 工作日      |
| -- | ----------- | ------------ | ------------ | ------------ | ------------ | ---- | ---- | ----------- |
| W7 | **9** | **10** | **11** | 12🧧         | 13🧧         | 14🧧 | 15🧧 | **3** |
| W8 | 16🧧        | 17🧧         | 18🧧         | 19🧧         | 20🧧         | 21🧧 | 22🧧 | **0** |
| W9 | 23🧧        | **24** | **25** | **26** | **27** | 28   | 1    | **4** |

> 🧧 = 春节假期
> 2月有效工作日: **7天** (节前3天 + 节后4天)

**3月:**

| 周  | 一           | 二           | 三           | 四           | 五           | 六 | 日 | 工作日      |
| --- | ------------ | ------------ | ------------ | ------------ | ------------ | -- | -- | ----------- |
| W10 | **2**  | **3**  | **4**  | **5**  | **6**  | 7  | 8  | **5** |
| W11 | **9**  | **10** | **11** | **12** | **13** | 14 | 15 | **5** |
| W12 | **16** | **17** | **18** | **19** | **20** | 21 | 22 | **5** |
| W13 | **23** | **24** | **25** | **26** | **27** | 28 | 29 | **5** |
| W14 | **30** | **31** | —           | —           | —           | — | — | **2** |

> 3月有效工作日: **22天**

### 4.4 总计

| 月份           | 有效工作日          |
| -------------- | ------------------- |
| 2月 (9日起)    | **7**         |
| 3月            | **22**        |
| **合计** | **29 工作日** |

> ⚠️ **时间极度紧张**: 29个工作日内完成碰撞增强 + IK + 代码精简 + .so封装 + 测试 + 文档交付
> **策略**: 最大化AI辅助（预计节省40%编码时间）；优先级严格排列；非核心项可延期；Phase 1仅3天，需极度聚焦

---

## 五、迭代计划总览

### 5.1 三阶段规划 (29天)

```
2月                                       3月
9─11 12══════════23 24─27 ║ 2───────────13 ║ 16────────────────────31
P1   ════春节12天════ P2   ║   Phase 3 前半  ║      Phase 3 后半
(3天)                (4天) ║   (10天)        ║      (12天)
碰撞增强启动    IK+碰撞完成  ║ 代码精简+.so封装 ║  测试+文档+真机验证+交付
+IK框架       +代码精简     ║ +API设计         ║
```

> ⚠️ Phase 1 仅有 **3个工作日**(2.9~2.11)，需极度聚焦核心：碰撞方案验证 + 编码骨架 + IK设计启动
> 大量编码工作推移到 Phase 2 (节后4天) 和 Phase 3A 前2天

### 5.2 里程碑

| 里程碑       | 日期         | 交付物                               | 验收标准                              |
| ------------ | ------------ | ------------------------------------ | ------------------------------------- |
| **M1** | 02-11 (周三) | 碰撞v3.0骨架 + IK设计 + 部分编码     | 碰撞方案验证；                        |
| —           | 02-12~23     | **🧧 春节假期 (12天)**         | —                                    |
| **M2** | 02-27 (周五) | IK完整 + 碰撞测试通过 + 代码精简完成 | FK→IK→FK<0.01mm；全部旧测试通过     |
| **M3** | 03-13 (周五) | .so库可编译 + C API可用              | C程序调用libPalletizingPlanner.so成功 |
| **M4** | 03-27 (周五) | 全量测试通过 + 文档完成 + 真机验证   | 稳定性/性能/精度全部达标              |
| **M5** | 03-31 (周二) | **🎉 最终交付**                | .so + 头文件 + 文档 + 示例打包完成    |

### 5.3 关键时间节点策略

| 决策点       | 日期 | 问题                   | AI辅助策略                            |
| ------------ | ---- | ---------------------- | ------------------------------------- |
| 碰撞方案确认 | 2.10 | 双次调用 vs 自实现几何 | 对比方案+生成骨架                     |
| IK方案确认   | 2.11 | DH验证+球腕分离        | 生成代码                              |
| 代码合并启动 | 2.26 | 优化版为主+特性提取    | AI分析差异矩阵并生成合并方案          |
| API冻结      | 3.10 | C API头文件冻结        | AI生成完整头文件+Doxygen              |
| 真机Day-1    | 3.23 | 首次真机轨迹回放       | 提前3.18准备真机导出脚本              |
| Go/No-Go     | 3.27 | 是否可交付             | 根据测试结果决定3.28-31用于修复或文档 |

---

## 六、Sprint 详细计划

---

### Phase 1: 碰撞方案验证 + IK设计启动 (节前3天冲刺)

**📅 2026-02-09 (周一) ~ 2026-02-11 (周三) | 3 工作日**

> **目标**: 春节前仅3天！聚焦**方案验证和骨架搭建**：验证HRC碰撞双调用方案可行性 + 编写碰撞v3.0核心 + IK公式推导与框架编码。
> **原则**: 不追求完成度，追求**方向正确性**。节后Phase 2集中补完编码和测试。
> **AI策略**: 2.9碰撞方案AI对比生成 → 2.10碰撞编码AI辅助 → 2.11 IK公式AI全程推导

#### 任务分解

| #   | 任务                                              | 天数 | 产出                                 | 优先级 |
| --- | ------------------------------------------------- | ---- | ------------------------------------ | ------ |
| 1.1 | HRC碰撞接口深度调研 +**立即验证**方案可行性 | 0.5  | 碰撞增强方案确认(双调用或自实现)     | P0     |
| 1.2 | CollisionChecker v3.0 — 碰撞源分离核心编码       | 1.5  | v3.0碰撞检测骨架(可编译+基本测试)    | P0     |
| 1.3 | IK解析求解 — AI推导公式 + 框架编码               | 1    | `InverseKinematics.hpp` 框架+J1-J3 | P0     |

#### 每日安排

| 日期 | 星期 | 上午                                                            | 下午                                        | 交付                                |
| ---- | ---- | --------------------------------------------------------------- | ------------------------------------------- | ----------------------------------- |
| 2.9  | 一   | 1.1 碰撞接口调研 (读algorithmLibInterface.h + 测试linkWall切换) | 1.2 碰撞v3.0设计 + 开始编码(碰撞源分离框架) | 碰撞方案确定 + 设计文档             |
| 2.10 | 二   | 1.2 碰撞v3.0核心编码 (双调用/自实现逻辑)                        | 1.2 碰撞v3.0基本场景验证                    | CollisionChecker v3.0 可编译        |
| 2.11 | 三   | 1.3 IK: AI推导球腕分离公式 + 腕中心+J1/J2/J3编码                | 1.3 IK: J4/J5/J6框架 + 代码提交收尾         | **M1** ✅ IK框架+碰撞v3.0骨架 |

> ⚠️ Phase 1 仅完成碰撞**骨架** + IK**前半部分**(J1-J3)。J4-J6细化、IK测试、碰撞全面测试均推迟到Phase 2

#### 碰撞检测v3.0设计

```
isCollisionFree(config) 流程:
┌──────────────────────────────────────────────────────────┐
│ 1. jointLimitsCheck(config) → 快速剪枝                    │
│ 2. collisionCache.check(config) → 缓存命中直接返回        │
│ 3. updateACAreaConstrainPackageInterface(config_deg)      │
│                                                          │
│ [方案A: 双次调用法 — 首选]                                 │
│ 4a. setCPSelfColliderLinkModelOpenState(false)            │
│ 5a. checkCPSelfCollision → selfDist (纯自碰撞)           │
│ 6a. setCPSelfColliderLinkModelOpenState(true)             │
│ 7a. checkCPSelfCollision → mixedDist (自碰撞+连杆环境)   │
│ 8a. linkEnvDist = min(mixedDist, selfDist)                │
│     if mixedDist < selfDist → 连杆碰到环境了              │
│                                                          │
│ [方案B: 自实现几何 — 备选]                                 │
│ 4b. checkCPSelfCollision → selfDist                       │
│ 5b. FK → 各连杆世界坐标capsule                           │
│ 6b. capsuleOBBDistance(每段连杆, 每个障碍物) → linkEnvDist │
│                                                          │
│ 9.  getACTCPInAreaList → tcpAreaCheck (TCP区域入侵)       │
│ 10. collisionReport = {selfDist, linkEnvDist, tcpArea}    │
│ 11. collisionCache.store(config, result)                  │
│ 12. return minDist > safetyMargin                         │
└──────────────────────────────────────────────────────────┘
```

#### IK核心算法概要

```
HR_S50-2000 解析IK (标准球腕6DOF):
┌──────────────────────────────────────────────┐
│ Input: T_target (4x4齐次变换矩阵)             │
│                                              │
│ 1. 计算腕中心 P_wrist = T_target * [0,0,-d6]│
│ 2. J1 = atan2(Py, Px)  — 2解(+π)            │
│ 3. J3 = acos(...) 余弦定理  — 2解(肘上/下)   │
│ 4. J2 由J3确定  — 与J3配对                    │
│ 5. R_03 = f(J1,J2,J3)                       │
│ 6. R_36 = R_03^T * R_target                 │
│ 7. J5 = acos(R_36[2][2])  — 2解(翻转)       │
│ 8. J4, J6 由 R_36 元素确定                   │
│ 9. 输出 ≤8 解 → 过滤关节限位 → 碰撞过滤      │
│ 10. 最优解: min(加权距离+可操作度)            │
└──────────────────────────────────────────────┘
```

---

### Phase 2: IK完成 + 碰撞完善 + 代码精简 (节后)

**📅 2026-02-24 (周二) ~ 2026-02-27 (周五) | 4 工作日**

> **目标**: 春节后4天全力冲刺。**完成Phase 1留下的全部编码**：IK J4-J6补完+8解组装+全量测试，碰撞v3.0完善+边界测试，同步启动代码精简。
> **关键**: Phase 2结束时IK和碰撞必须完全可用；代码冗余尽量消除（如溢出可推到Phase 3A前2天）。
> **节奏**: 4天紧凑安排，上下午切换任务保持专注

#### 任务分解

| #   | 任务                                            | 天数 | 产出                           | 优先级 |
| --- | ----------------------------------------------- | ---- | ------------------------------ | ------ |
| 2.1 | IK编码补完: J4/J5/J6 + 8解组装 + 关节限位过滤   | 1    | `InverseKinematics.hpp` 完整 | P0     |
| 2.2 | IK测试: 最优解选择 + FK→IK→FK 1000+随机验证   | 0.5  | 位置误差<0.01mm                | P0     |
| 2.3 | 碰撞v3.0完善: 边界测试 + 连杆-OBB距离查询       | 0.5  | 碰撞场景覆盖 + 距离度量        | P0     |
| 2.4 | IK集成到 TaskSequencer + PalletizingPlanner     | 0.5  | 码垛位姿精确求解               | P0     |
| 2.5 | PathPlanner三套→一套合并 + ParallelPlanner删除 | 0.5  | 统一PathPlanner.hpp            | P1     |
| 2.6 | PathOptimizer/TimeParam合并 + 回归测试          | 1    | 消除全部冗余 + 全测试通过      | P1     |

#### 每日安排

| 日期 | 星期 | 上午                                                  | 下午                                        | 交付                  |
| ---- | ---- | ----------------------------------------------------- | ------------------------------------------- | --------------------- |
| 2.24 | 二   | 2.1 IK编码: J4/J5/J6求解(ZYZ欧拉角) + 8解组装         | 2.1 IK: 关节限位过滤 + 最优解选择(加权距离) | IK完整算法            |
| 2.25 | 三   | 2.2 IK测试(1000+随机FK→IK→FK) + 奇异点处理          | 2.3 碰撞v3.0边界测试 + 连杆-OBB距离封装     | IK+碰撞全部验证OK     |
| 2.26 | 四   | 2.4 IK集成到顶层API                                   | 2.5 PathPlanner合并(AI分析差异+生成代码)    | 集成完成 + 规划器统一 |
| 2.27 | 五   | 2.6 PathOptimizer+TimeParam合并 + 删除Parallel+旧文件 | 2.6 全量回归测试 + 代码Review + 提交        | **M2** ✅       |

> ⚠️ 如2.5/2.6代码精简未完成，可溢出到3.2-3.3(Phase 3A开始前2天)，不影响.so封装

#### 代码合并策略 (AI辅助)

```
合并原则: 保留Optimized版本为基础，提取非Optimized版本中有价值的特性
┌──────────────────────────────────────────────────┐
│ PathPlanner 合并:                                 │
│   PathPlannerOptimized.hpp (主体)                 │
│   + PathPlanner.hpp 中的BIT*模式 (如有差异)       │
│   → 删除 PathPlanner.hpp, ParallelPathPlanner.hpp│
│                                                  │
│ PathOptimizer 合并:                               │
│   PathOptimizerOptimized.hpp (主体)               │
│   + PathOptimizer.hpp 中的基础B-Spline (已含)     │
│   → 删除 PathOptimizer.hpp                       │
│                                                  │
│ TimeParameterization 合并:                        │
│   TimeParameterizationOptimized.hpp (主体)        │
│   + TimeParameterization.hpp 中的TOPP-RA声明(删)  │
│   → 删除 TimeParameterization.hpp                │
│                                                  │
│ 预计净减: ~2000行代码                              │
└──────────────────────────────────────────────────┘
```

---

### Phase 3: .so库封装 + 测试 + 交付 (全力冲刺)

**📅 2026-03-02 (周一) ~ 2026-03-31 (周二) | 22 工作日**

> **目标**: 完成 .so 库封装、全面测试、真机验证、文档编写和最终交付打包。
> **这是最长也最关键的阶段**，分为三个子阶段精确管理。

#### 3A: .so 库封装 (3.2 ~ 3.13, 10天)

| #    | 任务                                         | 天数 | 产出                                  | 优先级 |
| ---- | -------------------------------------------- | ---- | ------------------------------------- | ------ |
| 3.1  | C API头文件设计 (`PlannerAPI.h`)           | 1.5  | `extern "C"` 纯C接口                | P0     |
| 3.2  | C API实现 (`PlannerAPI.cpp`) — 桥接C→C++ | 2    | 完整桥接层                            | P0     |
| 3.3  | CMake .so构建目标 + 符号可见性               | 1    | `libPalletizingPlanner.so` 可编译   | P0     |
| 3.4  | C API基本功能测试 (C程序调用.so)             | 1    | C端到端调用成功                       | P0     |
| 3.5  | 碰撞缓存场景变更自动清空                     | 0.5  | add/removeObstacle自动清缓存          | P1     |
| 3.6  | 配置文件化 (DH/碰撞几何/关节限位)            | 1    | `config/hr_s50.yaml` (或编译期默认) | P1     |
| 3.7  | 异常处理完善 (无效输入/不可达/超时)          | 1    | 所有错误码定义                        | P0     |
| 3.8  | 线程安全验证 (多实例调用测试)                | 0.5  | 文档标注线程模型                      | P1     |
| 3.9  | 构建脚本 `build.sh` + DH统一               | 0.5  | 一键构建                              | P2     |
| 3.10 | 中期集成测试                                 | 1    | 所有测试通过                          | P0     |

##### 3A 每日安排

| 日期  | 星期 | 任务                                                 |
| ----- | ---- | ---------------------------------------------------- |
| 3.2   | 一   | 3.1 C API设计 (函数签名/数据结构/错误码)             |
| 3.3   | 二   | 3.1 完成 + 3.2 C API实现(1/2)                        |
| 3.4   | 三   | 3.2 C API实现(2/2)                                   |
| 3.5   | 四   | 3.3 CMake .so + 符号可见性 + 版本脚本                |
| 3.6   | 五   | 3.4 C API功能测试 (C程序端到端)                      |
| 3.7-8 | 六日 | 周末                                                 |
| 3.9   | 一   | 3.5 缓存清空 + 3.7 异常处理(1/2)                     |
| 3.10  | 二   | 3.7 异常处理(2/2) + 3.8 线程安全 →**API冻结** |
| 3.11  | 三   | 3.6 配置文件化                                       |
| 3.12  | 四   | 3.9 构建脚本/DH统一 + 3.10 集成测试                  |
| 3.13  | 五   | 3.10 集成测试完成                                    |

---

#### 3B: 全面测试 + 真机验证 (3.16 ~ 3.27, 10天)

| #    | 任务                                | 天数 | 产出              | 优先级 |
| ---- | ----------------------------------- | ---- | ----------------- | ------ |
| 3.11 | 性能测试套件 (1000次随机场景)       | 1    | 性能基准报告      | P0     |
| 3.12 | 边界场景测试 (极限关节/窄通道/奇异) | 1    | 边界通过率 > 95%  | P0     |
| 3.13 | 压力测试 (连续10000次规划)          | 0.5  | 零崩溃            | P0     |
| 3.14 | Valgrind内存检查                    | 0.5  | 零泄漏            | P0     |
| 3.15 | 真机轨迹导出脚本准备                | 0.5  | 控制器可用格式    | P0     |
| 3.16 | 真机P2P轨迹验证 (5+组)              | 1.5  | 平滑执行          | P0     |
| 3.17 | 真机码垛场景验证 (带障碍物)         | 1.5  | 有效避障          | P0     |
| 3.18 | 真机问题修复 + 参数调优             | 1.5  | 碰撞余量/步长适配 | P0     |
| 3.19 | API稳定性修正 (真机反馈)            | 0.5  | 接口变更闭环      | P0     |
| 3.20 | 回归测试 (修复后全量)               | 1    | 全部通过          | P0     |

> ⚠️ **真机风险**: 如果真机3月下旬不可用，3.16-3.18改为仿真验证(Python可视化+MATLAB碰撞分析)

##### 3B 每日安排

| 日期    | 星期 | 任务                              |
| ------- | ---- | --------------------------------- |
| 3.16    | 一   | 3.11 性能测试 (1000场景自动化)    |
| 3.17    | 二   | 3.12 边界场景测试                 |
| 3.18    | 三   | 3.13 压力测试 + 3.14 Valgrind     |
| 3.19    | 四   | 3.15 真机脚本 + 3.16 真机P2P(1/2) |
| 3.20    | 五   | 3.16 真机P2P(2/2)                 |
| 3.21-22 | 六日 | 周末                              |
| 3.23    | 一   | 3.17 真机码垛验证(1/2)            |
| 3.24    | 二   | 3.17 真机码垛验证(2/2)            |
| 3.25    | 三   | 3.18 问题修复+调优(1/2)           |
| 3.26    | 四   | 3.18 修复(2/2) + 3.19 API修正     |
| 3.27    | 五   | 3.20 全量回归测试                 |

---

#### 3C: 文档 + 打包交付 (3.30 ~ 3.31, 2天)

| #    | 任务                               | 天数 | 产出                          | 优先级 |
| ---- | ---------------------------------- | ---- | ----------------------------- | ------ |
| 3.21 | API参考文档 (AI辅助Doxygen + 中文) | 0.5  | `docs/API_Reference.md`     | P0     |
| 3.22 | 集成指南 (CMake/链接/示例)         | 0.5  | `docs/Integration_Guide.md` | P0     |
| 3.23 | 调用示例程序 (C + C++)             | 0.5  | `examples/c_api_example.c`  | P0     |
| 3.24 | Release构建 + 打包 + CHANGELOG     | 0.25 | `release/` 完整交付物       | P0     |
| 3.25 | 内部演示 + 知识转移准备            | 0.25 | 交接文档/演示PPT              | P1     |

> **文档策略**: 利用AI从代码注释批量生成文档，人工Review+补充关键说明，最大化效率

##### 3C 每日安排

| 日期 | 星期 | 上午                         | 下午                          | 交付                     |
| ---- | ---- | ---------------------------- | ----------------------------- | ------------------------ |
| 3.30 | 一   | 3.21 API文档 (AI生成+Review) | 3.22 集成指南 + 3.23 示例程序 | 文档完成                 |
| 3.31 | 二   | 3.24 Release打包 + CHANGELOG | 3.25 交付验收 + 知识转移      | **M5 最终交付** 🎉 |

---

## 七、风险登记簿

| ID | 风险                                  | 概率 | 影响 | 缓解措施                                                                          |
| -- | ------------------------------------- | ---- | ---- | --------------------------------------------------------------------------------- |
| R1 | HRC库不支持运行时切换linkWall状态     | 中   | 高   | **2.9下午立即验证**；备选: getUIInfoMation取连杆几何→自实现capsule-OBB距离 |
| R2 | IK J5≈0奇异导致解不连续              | 高   | 中   | 阈值内(±0.1°)用J4+J6等价旋转；规划器避开奇异区域                                |
| R3 | HRC碰撞库全局锁导致.so多线程性能差    | 高   | 中   | 文档标注单线程限制；或每线程独立初始化HRC实例                                     |
| R4 | 春节后人员状态恢复慢                  | 中   | 中   | Phase 2首日安排IK编码(熟悉度高)作为热身                                           |
| R5 | 真机3月下旬不可用                     | 中   | 高   | **3月初预约**；不可用时改用仿真(Python+MATLAB)替代                          |
| R6 | 29天不足以完成所有任务                | 高   | 高   | P2任务(配置文件化等)可延后；文档用AI生成缩短周期；代码精简可溢出到Phase 3A前2天   |
| R7 | 三套规划器合并导致性能退化            | 低   | 高   | 合并保留Optimized核心不改动；立即A/B对比                                          |
| R8 | OBB数量上限(5个)不满足场景            | 低   | 中   | 自实现额外碰撞体或合并小障碍物为包围盒                                            |
| R9 | Phase 1仅有到3天，IK/碰撞未能完成骨架 | 中   | 高   | 碰撞方案验证2.9**必须当天出结果**；IK用AI全程推导压缩2.11完成框架           |

### 风险应对预案 — 时间不足时的优先级降级

**如果实际进度落后，按以下顺序降级:**

| 降级等级    | 可降级项                | 替代方案                 | 节省天数 |
| ----------- | ----------------------- | ------------------------ | -------- |
| 🟢 优先降级 | 代码精简 (2.5-2.6)      | 溢出到Phase 3A前2天      | 2天      |
| 🟢 优先降级 | Python/C++ DH统一 (3.9) | 手动保持一致             | 0.5天    |
| 🟡 酌情降级 | 线程安全验证 (3.8)      | 文档标注"建议单线程使用" | 0.5天    |
| 🟡 酌情降级 | Valgrind (3.14)         | 只做功能不做内存检查     | 0.5天    |
| 🔴 最后降级 | 真机验证 (3.16-3.18)    | 仿真替代，4月初补做      | 3天      |
| ❌ 不可降级 | IK / 碰撞增强 / .so封装 | —                       | —       |

---

## 八、验收标准

### 8.1 库功能验收

| 编号 | 验收项         | 标准                              | 验证方法              |
| ---- | -------------- | --------------------------------- | --------------------- |
| A1   | IK精度         | FK→IK→FK位置误差 < 0.01mm       | 1000+随机测试         |
| A2   | 规划成功率     | ≥ 99% (无障碍) / ≥ 95% (有障碍) | 自动化测试            |
| A3   | 规划速度       | Pipeline ≤ 200ms (典型场景)      | 性能基准              |
| A4   | 碰撞检测完整性 | 自碰撞+连杆-环境+TCP区域 (可区分) | 碰撞场景测试集        |
| A5   | 碰撞安全余量   | 可配置，默认 ≥ 10mm              | 贴近场景测试          |
| A6   | 路径平滑度     | B-Spline最大曲率 < 阈值           | 曲率分析              |
| A7   | 内存安全       | Valgrind零泄漏、零越界            | Valgrind报告          |
| A8   | 稳定性         | 连续10000次规划零崩溃             | 压力测试              |
| A9   | .so可链接      | C程序10行内完成调用               | 示例程序编译运行成功  |
| A10  | 真机有效性     | 规划轨迹在真机执行平滑无跳变      | 真机回放 (或仿真替代) |

### 8.2 交付物清单

| 交付物                               | 格式      | 说明                      |
| ------------------------------------ | --------- | ------------------------- |
| `libPalletizingPlanner.so`         | ELF共享库 | Linux x86_64              |
| `include/PlannerAPI.h`             | C头文件   | 纯C接口,`extern "C"`    |
| `include/PalletizingPlanner/*.hpp` | C++头文件 | 高级用户可直接使用C++ API |
| `docs/API_Reference.md`            | 文档      | 所有 `pp_*` 函数参考    |
| `docs/Integration_Guide.md`        | 文档      | CMake集成/链接/编译指南   |
| `examples/c_api_example.c`         | 示例      | C语言调用示例             |
| `examples/cpp_api_example.cpp`     | 示例      | C++调用示例               |
| `lib/libHRCInterface.a` 等         | 静态库    | HRC碰撞检测依赖           |
| `build.sh`                         | 脚本      | 一键构建                  |
| 测试报告                             | MD        | 性能/精度/稳定性数据      |

---

## 附录A: 甘特图

```
2026年
2月                                          3月
9  10  11 |12══════春节══════23| 24 25 26 27 | 2  3  4  5  6 | 9 10 11 12 13 | 16 17 18 19 20 | 23 24 25 26 27 | 30 31
├─Phase1─┤  █████████████  ├── Phase2 ─┤   ├──── 3A: .so封装 ────┤   ├── 3B: 测试+真机 ──────────────┤   ├ 3C ┤
碰撞启动+IK设计  春节12天  IK+碰撞+精简(4d) C API+.so构建(10d)        全面测试+真机验证(10d)          文档+交付(2d)
(3d)                                 ▲M3                      ▲M4                          ▲M5
▲M1                   ▲M2           3.13                     3.27                         3.31
2.11                   2.27
```

## 附录B: 文件变更汇总

### 新增

```
include/PalletizingPlanner/InverseKinematics.hpp    (Phase 1)
include/PlannerAPI.h                                 (Phase 3A, C API)
src/PlannerAPI.cpp                                   (Phase 3A, C API实现)
test/testInverseKinematics.cpp                       (Phase 1-2)
test/testCApiIntegration.c                           (Phase 3A)
examples/c_api_example.c                             (Phase 3C)
build.sh                                             (Phase 3A)
docs/API_Reference.md                                (Phase 3C)
docs/Integration_Guide.md                            (Phase 3C)
```

### 合并删除 (Phase 2)

```
PathPlanner.hpp + PathPlannerOptimized.hpp + ParallelPathPlanner.hpp
  → 统一 PathPlannerOptimized.hpp (重命名为 PathPlanner.hpp)

PathOptimizer.hpp + PathOptimizerOptimized.hpp
  → 统一 PathOptimizerOptimized.hpp (重命名为 PathOptimizer.hpp)

TimeParameterization.hpp + TimeParameterizationOptimized.hpp
  → 统一 TimeParameterizationOptimized.hpp (重命名为 TimeParameterization.hpp)
```

### 重大修改

```
CollisionChecker.hpp   — v3.0 碰撞源分离 + 连杆-环境完整覆盖    (Phase 1)
RobotModel.hpp         — 集成IK                                 (Phase 1-2)
TaskSequencer.hpp      — 使用IK替代硬编码                        (Phase 2)
PalletizingPlanner.hpp — 使用IK + 笛卡尔API                     (Phase 2)
HighPerformancePlanner.hpp — 适配合并后的统一模块                 (Phase 2)
CMakeLists.txt         — 新增.so构建目标                         (Phase 3A)
test/CMakeLists.txt    — 新增测试目标                            (Phase 1-2)
```

---

## 附录C: 每周检查点

| 周 | 日期范围  | 检查指标                               | 预期状态                               |
| -- | --------- | -------------------------------------- | -------------------------------------- |
| W1 | 2.9-2.11  | CollisionChecker v3.0骨架 + IK设计启动 | 碰撞方案已验证; IK J1-J3编码完成       |
| — | 2.12-2.23 | **春节 (12天)**                  | —                                     |
| W2 | 2.24-2.27 | IK完整 + 碰撞测试 + 代码精简           | 1000+测试通过; 冗余代码删除(或延到3.2) |
| W3 | 3.2-3.6   | C API设计 + 实现                       | PlannerAPI.h冻结; 桥接层编码完成       |
| W4 | 3.9-3.13  | .so可编译 + C端测试通过                | libPalletizingPlanner.so可链接调用     |
| W5 | 3.16-3.20 | 自动化测试完成                         | 性能/边界/压力/内存全部通过            |
| W6 | 3.23-3.27 | 真机验证                               | P2P+码埚场景通过(或仿真替代)           |
| W7 | 3.30-3.31 | 交付打包                               | release/目录包含全部交付物             |

---

> **更新策略**: 每周五检查点时更新此文档，记录实际进度与偏差。
> **AI辅助**: IK推导、碰撞几何计算、测试用例生成、代码合并、API文档均借助AI加速，预计节省约40%编码时间。
> **降级策略**: 若落后，按风险登记簿中降级顺序执行，确保核心功能(碰撞增强+IK+.so)不受影响。
>

---

*© 2026 Guangdong Huayan Robotics Co., Ltd.*
